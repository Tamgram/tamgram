theory Visa_DDA_Low_Fix begin

// Function signature and definition of the equational theory E

builtins: xor
functions: MAC_29/2, MAC_arpc_30/2, adec/2, aenc/2, f_28/2, fst/1, h/1,
           p8_31/1, pair/2, pk/1, sign/2, snd/1, true/0, verify/3
equations:
    adec(aenc(x.1, pk(x.2)), x.2) = x.1,
    fst(<x.1, x.2>) = x.1,
    snd(<x.1, x.2>) = x.2,
    verify(sign(x.1, x.2), x.1, pk(x.2)) = true



/* looping facts with injective instances: St/3 */

rule (modulo E) Terminal_Bank_Network_42:
   [ Send_32( S_40, R_41, channelID_39, msg_38 ) ]
  -->
   [ Recv_33( S_40, R_41, channelID_39, msg_38 ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Generate_Amount_Low_43:
   [ ]
  --[ Once_34( <$amount, 'Amount'> ) ]->
   [ !Value_35( $amount, 'Low' ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Generate_Amount_High_44:
   [ ]
  --[ Once_34( <$amount, 'Amount'> ) ]->
   [ !Value_35( $amount, 'High' ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Generate_ATC_46:
   [ Fr( ~ATC_45 ) ] --> [ !ATC_36( ~ATC_45 ), Out( ~ATC_45 ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Generate_SDAD_Format_Visa_47:
   [ ] --> [ !SDADFormat_37( '05', 'TC' ), !SDADFormat_37( '95', 'ARQC' ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Create_CA_55:
   [ Fr( ~privkCA_51 ) ]
  --[ Once_34( $CA ), Role_48( $CA, 'CA' ) ]->
   [
   !LtkCA_49( $CA, ~privkCA_51 ),
   !CertCA_50( $CA,
               <<'01', $CA, pk(~privkCA_51), $CA>, 
                sign(<'01', $CA, pk(~privkCA_51), $CA>, ~privkCA_51)>
   ),
   Out( pk(~privkCA_51) )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) Create_Bank_64:
   [ Fr( ~privkBank_60 ), !LtkCA_49( $CA, ~privkCA_59 ) ]
  --[ Once_34( $Bank ), Role_48( $Bank, 'Bank' ) ]->
   [
   !LtkBank_56( $Bank, ~privkBank_60 ),
   !CertBank_57( $Bank,
                 <<'02', $Bank, pk(~privkBank_60), $CA>, 
                  sign(<'02', $Bank, pk(~privkBank_60), $CA>, ~privkCA_59)>
   ),
   !IssuingCA_58( $Bank, $CA ), Out( pk(~privkBank_60) )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) Compromise_CA_69:
   [ !LtkCA_49( $CA, ~privkCA_68 ) ]
  --[ Compromise_65( $CA ) ]->
   [ Out( ~privkCA_68 ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Compromise_Bank_71:
   [ !LtkBank_56( $Bank, ~privkBank_70 ) ]
  --[ Compromise_65( $Bank ) ]->
   [ Out( <$Bank, ~privkBank_70> ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Compromise_Card_75:
   [ !LtkCard_72( ~PAN_74, ~privkCard_73 ) ]
  --[ Compromise_65( ~PAN_74 ) ]->
   [ Out( <~PAN_74, ~privkCard_73> ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Compromise_Bank_Card_ShK_78:
   [ !IssuingBank_66( ~PAN_76, $Bank ), !Shk_67( ~PAN_76, ~MK_77 ) ]
  --[ Compromise_65( $Bank ), Compromise_65( ~PAN_76 ) ]->
   [ Out( ~MK_77 ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) Set_PIN_89:
   [ Fr( ~PIN_86 ), Set_PIN_83( ~PAN_87, CVM_88, $CA, $Bank ) ]
  --[
  NEq_26( CVM_88, 'NoPIN' ), SecretPIN_79( ~PIN_86 ), Honest_80( $CA ),
  Honest_80( $Bank ), Honest_80( ~PAN_87 )
  ]->
   [
   !PIN_85( ~PAN_87, ~PIN_86 ), !Entered_PIN_84( ~PAN_87, ~PIN_86 ),
   !Entered_PIN_84( ~PAN_87, 'WrongPIN' )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgStartSet_Records_114_12:
   [ Fr( ~pid ) ] --> [ St( ~pid, 'tgk12', 'empty_tuple' ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleSet_Records_114_12to13:
   [
   St( ~pid, 'tgk12', 'empty_tuple' ),
   Set_Records_93( ~PAN_101, ~expDate_97, $CA, certBank_98, SSAD_100,
                   CVM_102
   ),
   !AIP_94( ~PAN_101, <'SDA', u_furtherData_99> )
   ]
  -->
   [
   !Records_95( ~PAN_101,
                <~PAN_101, ~expDate_97, $CA, certBank_98, SSAD_100, CVM_102>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleSet_Records_114_12to14:
   [
   St( ~pid, 'tgk12', 'empty_tuple' ),
   Set_Records_93( ~PAN_108, ~expDate_105, $CA, certBank_106, SSAD_107,
                   CVM_109
   ),
   Fr( ~privkCard_103 ), !AIP_94( ~PAN_108, AIP_110 ),
   !IssuingBank_66( ~PAN_108, $Bank ), !LtkBank_56( $Bank, ~privkBank_104 )
   ]
  --[
  NEq_26( fst(AIP_110), 'SDA' ), SecretPrivkCard_96( ~privkCard_103 ),
  Honest_80( $CA ), Honest_80( $Bank ), Honest_80( ~PAN_108 )
  ]->
   [
   Out( pk(~privkCard_103) ), !LtkCard_72( ~PAN_108, ~privkCard_103 ),
   !Records_95( ~PAN_108,
                <~PAN_108, ~expDate_105, $CA, certBank_106, 
                 <<'04', ~PAN_108, pk(~privkCard_103), $Bank, CVM_109, AIP_110>, 
                  sign(<'04', ~PAN_108, pk(~privkCard_103), $Bank, CVM_109, AIP_110>,
                       ~privkBank_104)
                 >, 
                 CVM_109>
   )
   ]

  /*
  rule (modulo AC) TgRuleSet_Records_114_12to14:
     [
     St( ~pid, 'tgk12', 'empty_tuple' ),
     Set_Records_93( ~PAN_108, ~expDate_105, $CA, certBank_106, SSAD_107,
                     CVM_109
     ),
     Fr( ~privkCard_103 ), !AIP_94( ~PAN_108, AIP_110 ),
     !IssuingBank_66( ~PAN_108, $Bank ), !LtkBank_56( $Bank, ~privkBank_104 )
     ]
    --[
    NEq_26( z, 'SDA' ), SecretPrivkCard_96( ~privkCard_103 ),
    Honest_80( $CA ), Honest_80( $Bank ), Honest_80( ~PAN_108 )
    ]->
     [
     Out( pk(~privkCard_103) ), !LtkCard_72( ~PAN_108, ~privkCard_103 ),
     !Records_95( ~PAN_108,
                  <~PAN_108, ~expDate_105, $CA, certBank_106, 
                   <<'04', ~PAN_108, pk(~privkCard_103), $Bank, CVM_109, AIP_110>, 
                    sign(<'04', ~PAN_108, pk(~privkCard_103), $Bank, CVM_109, AIP_110>,
                         ~privkBank_104)
                   >, 
                   CVM_109>
     )
     ]
    variants (modulo AC)
    1. AIP_110
             = AIP_110.17
       z     = fst(AIP_110.17)
    
    2. AIP_110
             = <z.24, x.32>
       z     = z.24
  */

rule (modulo E) Create_Card_124:
   [
   Fr( ~PAN_119 ), Fr( ~expDate_116 ), Fr( ~MK_120 ),
   !LtkBank_56( $Bank, ~privkBank_115 ),
   !CertBank_57( $Bank, certBank_117 ), !IssuingCA_58( $Bank, $CA ),
   In( <auth_118, CVM_121> )
   ]
  --[
  Role_48( ~PAN_119, 'Card' ), SecretPAN_81( ~PAN_119 ),
  SecretMK_82( ~MK_120 ), Honest_80( $CA ), Honest_80( $Bank ),
  Honest_80( ~PAN_119 )
  ]->
   [
   !AIP_94( ~PAN_119, <auth_118, $furtherData> ),
   !AID_90( ~PAN_119, 'Mastercard' ), !Shk_67( ~PAN_119, ~MK_120 ),
   !IssuingBank_66( ~PAN_119, $Bank ),
   Set_Records_93( ~PAN_119, ~expDate_116, $CA, certBank_117,
                   sign(<'03', ~PAN_119, ~expDate_116, auth_118, $furtherData>,
                        ~privkBank_115),
                   CVM_121
   ),
   Set_PIN_83( ~PAN_119, CVM_121, $CA, $Bank )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgStartCard_170_16:
   [ Fr( ~pid ) ] --> [ St( ~pid, 'tgk16', 'empty_tuple' ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleCard_170_16to17:
   [
   St( ~pid, 'tgk16', 'empty_tuple' ),
   In( <'GET_PROCESSING_OPTIONS', PDOL_125> ), !AIP_94( ~PAN_126, AIP_128 ),
   !AID_90( ~PAN_126, 'Mastercard' ), !ATC_36( ATC_127 )
   ]
  --[ OneCard_91( ), Once_34( <~PAN_126, ATC_127, 'Card'> ) ]->
   [
   St( ~pid, 'tgk17', <ATC_127, ~PAN_126, PDOL_125> ),
   Out( <AIP_128, 'AFL'> )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleCard_170_17to18:
   [
   St( ~pid, 'tgk17', <tgc_ATC_0, ~u_tgany2_130, tgc_PDOL_0> ),
   !AIP_94( ~u_tgany2_130, AIP_131 ),
   !Records_95( ~u_tgany2_130, records_129 ), In( <'READ_RECORD', 'AFL'> )
   ]
  --[ NEq_26( fst(AIP_131), 'DDA' ) ]->
   [
   St( ~pid, 'tgk18', <tgc_ATC_0, ~u_tgany2_130, tgc_PDOL_0> ),
   Out( records_129 )
   ]

  /*
  rule (modulo AC) TgRuleCard_170_17to18:
     [
     St( ~pid, 'tgk17', <tgc_ATC_0, ~u_tgany2_130, tgc_PDOL_0> ),
     !AIP_94( ~u_tgany2_130, AIP_131 ),
     !Records_95( ~u_tgany2_130, records_129 ), In( <'READ_RECORD', 'AFL'> )
     ]
    --[ NEq_26( z, 'DDA' ) ]->
     [
     St( ~pid, 'tgk18', <tgc_ATC_0, ~u_tgany2_130, tgc_PDOL_0> ),
     Out( records_129 )
     ]
    variants (modulo AC)
    1. AIP_131
             = AIP_131.13
       z     = fst(AIP_131.13)
    
    2. AIP_131
             = <z.22, x.32>
       z     = z.22
  */

rule (modulo E) TgRuleCard_170_17to19:
   [
   St( ~pid, 'tgk17', <tgc_ATC_0, ~u_tgany4_133, tgc_PDOL_0> ),
   !Records_95( ~u_tgany4_133, records_132 ),
   !AIP_94( ~u_tgany4_133, <'DDA', u_furtherData_134> ),
   In( <'READ_RECORD', 'AFL'> )
   ]
  -->
   [
   St( ~pid, 'tgk19', <tgc_ATC_0, ~u_tgany4_133, tgc_PDOL_0> ),
   Out( records_132 )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleCard_170_18to21:
   [ St( ~pid, 'tgk18', <tgc_ATC_0, tgc_PAN_0, tgc_PDOL_0> ) ]
  -->
   [ St( ~pid, 'tgk21', <tgc_ATC_0, tgc_PAN_0, tgc_PDOL_0> ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleCard_170_19to20:
   [
   St( ~pid, 'tgk19', <tgc_ATC_0, ~u_tgany3_137, tgc_PDOL_0> ),
   Fr( ~nc_136 ), !LtkCard_72( ~u_tgany3_137, ~privkCard_135 ),
   In( <'INTERNAL_AUTHENTICATE', DDOL_138> )
   ]
  -->
   [
   St( ~pid, 'tgk20', <tgc_ATC_0, ~u_tgany3_137, tgc_PDOL_0> ),
   Out( <~nc_136, sign(<'05', ~nc_136, DDOL_138>, ~privkCard_135)> )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleCard_170_20to21:
   [ St( ~pid, 'tgk20', <tgc_ATC_0, tgc_PAN_0, tgc_PDOL_0> ) ]
  -->
   [ St( ~pid, 'tgk21', <tgc_ATC_0, tgc_PAN_0, tgc_PDOL_0> ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleCard_170_21to22:
   [
   St( ~pid, 'tgk21', <tgc_ATC_0, ~u_tgany0_139, tgc_PDOL_0> ),
   !AIP_94( ~u_tgany0_139, AIP_143 ), !Shk_67( ~u_tgany0_139, ~MK_140 ),
   !IssuingBank_66( ~u_tgany0_139, $Bank ),
   In( <'GENERATE_AC', CID_142, 'NoCDA', 'TVR', CVM_141, 'HHMMSS'> )
   ]
  --[
  Running_92( ~u_tgany0_139, 'Terminal',
              <'Card', 'Terminal', ~u_tgany0_139, AIP_143, CVM_141, 
               <tgc_PDOL_0, 'TVR', CVM_141, 'HHMMSS'>, tgc_ATC_0, 
               MAC_29(f_28(~MK_140, tgc_ATC_0),
                      <<tgc_PDOL_0, 'TVR', CVM_141, 'HHMMSS'>, AIP_143, tgc_ATC_0, 'IAD', 
                       CID_142>), 
               'IAD', CID_142>
  ),
  Running_92( ~u_tgany0_139, $Bank,
              <'Card', 'Bank', ~u_tgany0_139, AIP_143, CVM_141, 
               <tgc_PDOL_0, 'TVR', CVM_141, 'HHMMSS'>, tgc_ATC_0, 
               MAC_29(f_28(~MK_140, tgc_ATC_0),
                      <<tgc_PDOL_0, 'TVR', CVM_141, 'HHMMSS'>, AIP_143, tgc_ATC_0, 'IAD', 
                       CID_142>), 
               'IAD', CID_142>
  )
  ]->
   [
   Out( <CID_142, tgc_ATC_0, 
         MAC_29(f_28(~MK_140, tgc_ATC_0),
                <<tgc_PDOL_0, 'TVR', CVM_141, 'HHMMSS'>, AIP_143, tgc_ATC_0, 'IAD', 
                 CID_142>), 
         'IAD', CID_142>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleCard_170_21to23:
   [
   St( ~pid, 'tgk21',
       <tgc_ATC_0, ~u_tgany1_156, amount_155, country_154, currency_153, 
        date_152, type_149, UN_158>
   ),
   !LtkCard_72( ~u_tgany1_156, ~privkCard_150 ),
   !AIP_94( ~u_tgany1_156, <'CDA', u_furtherData_157> ),
   !Shk_67( ~u_tgany1_156, ~MK_159 ),
   !IssuingBank_66( ~u_tgany1_156, $Bank ), Fr( ~nc_151 ),
   In( <'GENERATE_AC', CID_161, 'CDA', 'TVR', CVM_160, 'HHMMSS'> )
   ]
  --[
  Running_92( ~u_tgany1_156, 'Terminal',
              <'Card', 'Terminal', ~u_tgany1_156, <'CDA', u_furtherData_157>, CVM_160, 
               <<amount_155, country_154, currency_153, date_152, type_149, UN_158>, 
                'TVR', CVM_160, 'HHMMSS'>, 
               tgc_ATC_0, 
               MAC_29(f_28(~MK_159, tgc_ATC_0),
                      <
                       <<amount_155, country_154, currency_153, date_152, type_149, UN_158>, 
                        'TVR', CVM_160, 'HHMMSS'>, 
                       <'CDA', u_furtherData_157>, tgc_ATC_0, 'IAD', CID_161>), 
               'IAD', CID_161>
  ),
  Running_92( ~u_tgany1_156, $Bank,
              <'Card', 'Bank', ~u_tgany1_156, <'CDA', u_furtherData_157>, CVM_160, 
               <<amount_155, country_154, currency_153, date_152, type_149, UN_158>, 
                'TVR', CVM_160, 'HHMMSS'>, 
               tgc_ATC_0, 
               MAC_29(f_28(~MK_159, tgc_ATC_0),
                      <
                       <<amount_155, country_154, currency_153, date_152, type_149, UN_158>, 
                        'TVR', CVM_160, 'HHMMSS'>, 
                       <'CDA', u_furtherData_157>, tgc_ATC_0, 'IAD', CID_161>), 
               'IAD', CID_161>
  )
  ]->
   [
   Out( <CID_161, tgc_ATC_0, 
         MAC_29(f_28(~MK_159, tgc_ATC_0),
                <
                 <<amount_155, country_154, currency_153, date_152, type_149, UN_158>, 
                  'TVR', CVM_160, 'HHMMSS'>, 
                 <'CDA', u_furtherData_157>, tgc_ATC_0, 'IAD', CID_161>), 
         <~nc_151, 
          sign(<'05', ~nc_151, CID_161, 
                MAC_29(f_28(~MK_159, tgc_ATC_0),
                       <
                        <<amount_155, country_154, currency_153, date_152, type_149, UN_158>, 
                         'TVR', CVM_160, 'HHMMSS'>, 
                        <'CDA', u_furtherData_157>, tgc_ATC_0, 'IAD', CID_161>), 
                h(<
                   <<amount_155, country_154, currency_153, date_152, type_149, UN_158>, 
                    'TVR', CVM_160, 'HHMMSS'>, 
                   CID_161, tgc_ATC_0, 
                   MAC_29(f_28(~MK_159, tgc_ATC_0),
                          <
                           <<amount_155, country_154, currency_153, date_152, type_149, UN_158>, 
                            'TVR', CVM_160, 'HHMMSS'>, 
                           <'CDA', u_furtherData_157>, tgc_ATC_0, 'IAD', CID_161>), 
                   'IAD', CID_161>), 
                UN_158>,
               ~privkCard_150)
         >, 
         'IAD', CID_161>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) Create_Card_Visa_182:
   [
   Fr( ~PAN_177 ), Fr( ~expDate_175 ), Fr( ~privkCard_173 ), Fr( ~MK_178 ),
   !LtkBank_56( $Bank, ~privkBank_174 ),
   !CertBank_57( $Bank, certBank_176 ), !IssuingCA_58( $Bank, $CA )
   ]
  --[
  Role_48( ~PAN_177, 'Card' ), SecretPAN_81( ~PAN_177 ),
  SecretMK_82( ~MK_178 ), SecretPrivkCard_96( ~privkCard_173 ),
  Honest_80( $CA ), Honest_80( $Bank ), Honest_80( ~PAN_177 )
  ]->
   [
   !LtkCard_72( ~PAN_177, ~privkCard_173 ), !AID_90( ~PAN_177, 'Visa' ),
   Out( pk(~privkCard_173) ), !ExpirationDate_171( ~PAN_177, ~expDate_175 ),
   !Shk_67( ~PAN_177, ~MK_178 ), !IssuingBank_66( ~PAN_177, $Bank ),
   !Records_Visa_172( ~PAN_177, ~expDate_175, $CA, certBank_176,
                      <<'04', ~PAN_177, pk(~privkCard_173), $Bank>, 
                       sign(<'04', ~PAN_177, pk(~privkCard_173), $Bank>, ~privkBank_174)>
   ),
   Set_PIN_83( ~PAN_177, 'OnlinePIN', $CA, $Bank )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgStartCard_Visa_244_25:
   [ Fr( ~pid ) ] --> [ St( ~pid, 'tgk25', 'empty_tuple' ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleCard_Visa_244_25to26:
   [
   St( ~pid, 'tgk25', 'empty_tuple' ),
   In( <'GET_PROCESSING_OPTIONS', <acType_189, CVM_193>, amount_188, 
        country_187, currency_186, date_185, type_183, UN_190>
   ),
   !Shk_67( ~PAN_191, ~MK_192 ), !AID_90( ~PAN_191, 'Visa' ),
   !ExpirationDate_171( ~PAN_191, ~expDate_184 ),
   !IssuingBank_66( ~PAN_191, $Bank ), !ATC_36( ATC_194 )
   ]
  --[
  OneCard_91( ), Once_34( <~PAN_191, ATC_194, 'Card'> ),
  NEq_26( CVM_193, 'CDCVM' ),
  Running_92( ~PAN_191, 'Terminal',
              <'Card', 'Terminal', ~PAN_191, <'EMV', $furtherData>, CVM_193, 
               <<acType_189, CVM_193>, amount_188, country_187, currency_186, date_185, 
                type_183, UN_190>, 
               ATC_194, 
               MAC_29(f_28(~MK_192, ATC_194),
                      <
                       <<acType_189, CVM_193>, amount_188, country_187, currency_186, date_185, 
                        type_183, UN_190>, 
                       <'EMV', $furtherData>, ATC_194, 'IAD', 'ARQC'>), 
               'IAD', 'ARQC'>
  ),
  Running_92( ~PAN_191, $Bank,
              <'Card', 'Bank', ~PAN_191, <'EMV', $furtherData>, CVM_193, 
               <<acType_189, CVM_193>, amount_188, country_187, currency_186, date_185, 
                type_183, UN_190>, 
               ATC_194, 
               MAC_29(f_28(~MK_192, ATC_194),
                      <
                       <<acType_189, CVM_193>, amount_188, country_187, currency_186, date_185, 
                        type_183, UN_190>, 
                       <'EMV', $furtherData>, ATC_194, 'IAD', 'ARQC'>), 
               'IAD', 'ARQC'>
  )
  ]->
   [
   St( ~pid, 'tgk26',
       <
        MAC_29(f_28(~MK_192, ATC_194),
               <
                <<acType_189, CVM_193>, amount_188, country_187, currency_186, date_185, 
                 type_183, UN_190>, 
                <'EMV', $furtherData>, ATC_194, 'IAD', 'ARQC'>), 
        <'EMV', $furtherData>, ATC_194, 'ARQC', CVM_193, <'IAD', 'ARQC'>, 
        ~PAN_191, <acType_189, CVM_193>, amount_188, country_187, currency_186, 
        date_185, type_183, UN_190>
   ),
   Out( <<'EMV', $furtherData>, 'AFL', <~PAN_191, ~expDate_184>, 
         <'IAD', 'ARQC'>, 
         MAC_29(f_28(~MK_192, ATC_194),
                <
                 <<acType_189, CVM_193>, amount_188, country_187, currency_186, date_185, 
                  type_183, UN_190>, 
                 <'EMV', $furtherData>, ATC_194, 'IAD', 'ARQC'>), 
         'ARQC', ATC_194, CVM_193>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleCard_Visa_244_25to27:
   [
   St( ~pid, 'tgk25', 'empty_tuple' ),
   In( <'GET_PROCESSING_OPTIONS', <CID_213, CVM_212>, amount_208, 
        country_207, currency_206, date_205, type_203, UN_209>
   ),
   !Shk_67( ~PAN_210, ~MK_211 ), !AID_90( ~PAN_210, 'Visa' ),
   !ExpirationDate_171( ~PAN_210, ~expDate_204 ), !ATC_36( ATC_214 )
   ]
  --[
  OneCard_91( ), Once_34( <~PAN_210, ATC_214, 'Card'> ),
  NEq_26( CVM_212, 'CDCVM' )
  ]->
   [
   St( ~pid, 'tgk27',
       <
        MAC_29(f_28(~MK_211, ATC_214),
               <
                <<CID_213, CVM_212>, amount_208, country_207, currency_206, date_205, 
                 type_203, UN_209>, 
                <'DDA', $furtherData>, ATC_214, 'IAD', CID_213>), 
        <'DDA', $furtherData>, ATC_214, CID_213, CVM_212, <'IAD', CID_213>, 
        ~PAN_210, <CID_213, CVM_212>, amount_208, country_207, currency_206, 
        date_205, type_203, UN_209>
   ),
   Out( <<'DDA', $furtherData>, 'AFL', <~PAN_210, ~expDate_204>, 
         <'IAD', CID_213>, 
         MAC_29(f_28(~MK_211, ATC_214),
                <
                 <<CID_213, CVM_212>, amount_208, country_207, currency_206, date_205, 
                  type_203, UN_209>, 
                 <'DDA', $furtherData>, ATC_214, 'IAD', CID_213>), 
         CID_213, ATC_214, CVM_212>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleCard_Visa_244_26to28:
   [
   St( ~pid, 'tgk26',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, tgc_CID_0, tgc_CTQ_0, tgc_IAD_0, 
        tgc_PAN_0, tgc_PDOL_0>
   )
   ]
  -->
   [
   St( ~pid, 'tgk28',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, tgc_CID_0, tgc_CTQ_0, tgc_IAD_0, 
        tgc_PAN_0, tgc_PDOL_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleCard_Visa_244_27to28:
   [
   St( ~pid, 'tgk27',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, tgc_CID_0, tgc_CTQ_0, tgc_IAD_0, 
        tgc_PAN_0, tgc_PDOL_0>
   )
   ]
  -->
   [
   St( ~pid, 'tgk28',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, tgc_CID_0, tgc_CTQ_0, tgc_IAD_0, 
        tgc_PAN_0, tgc_PDOL_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleCard_Visa_244_28to29:
   [
   St( ~pid, 'tgk28',
       <tgc_AC_0, <'EMV', u_furtherData_225>, tgc_ATC_0, tgc_CID_0, tgc_CTQ_0, 
        tgc_IAD_0, ~u_tgany5_224, tgc_PDOL_0>
   ),
   !Records_Visa_172( ~u_tgany5_224, ~expDate_221, $CA, certBank_223,
                      certCard_222
   ),
   In( <'READ_RECORD', 'AFL'> )
   ]
  -->
   [ Out( <~u_tgany5_224, ~expDate_221> ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleCard_Visa_244_28to30:
   [
   St( ~pid, 'tgk28',
       <tgc_AC_0, <'DDA', u_furtherData_238>, tgc_ATC_0, tgc_CID_0, tgc_CTQ_0, 
        tgc_IAD_0, ~u_tgany6_237, TTQ_240, amount_236, country_233, 
        currency_232, date_231, type_226, UN_239>
   ),
   !Records_Visa_172( ~u_tgany6_237, ~expDate_230, $CA, certBank_235,
                      certCard_234
   ),
   Fr( ~nc_228 ), !LtkCard_72( ~u_tgany6_237, ~privkCard_227 ),
   !SDADFormat_37( format_229, tgc_CID_0 ),
   !IssuingBank_66( ~u_tgany6_237, $Bank ), In( <'READ_RECORD', 'AFL'> )
   ]
  --[
  Running_92( ~u_tgany6_237, 'Terminal',
              <'Card', 'Terminal', ~u_tgany6_237, <'DDA', u_furtherData_238>, 
               tgc_CTQ_0, 
               <TTQ_240, amount_236, country_233, currency_232, date_231, type_226, 
                UN_239>, 
               tgc_ATC_0, tgc_AC_0, tgc_IAD_0>
  ),
  Running_92( ~u_tgany6_237, $Bank,
              <'Card', 'Bank', ~u_tgany6_237, <'DDA', u_furtherData_238>, tgc_CTQ_0, 
               <TTQ_240, amount_236, country_233, currency_232, date_231, type_226, 
                UN_239>, 
               tgc_ATC_0, tgc_AC_0, tgc_IAD_0>
  )
  ]->
   [
   Out( <~u_tgany6_237, ~expDate_230, $CA, certBank_235, certCard_234, 
         ~nc_228, tgc_CTQ_0, 
         sign(<format_229, ~nc_228, tgc_CID_0, tgc_AC_0, 
               <TTQ_240, amount_236, country_233, currency_232, date_231, type_226, 
                UN_239>, 
               tgc_ATC_0, tgc_CTQ_0, UN_239, tgc_IAD_0, 'DDA', u_furtherData_238>,
              ~privkCard_227)
        >
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgStartTerminal_361_31:
   [ Fr( ~pid ) ] --> [ St( ~pid, 'tgk31', 'empty_tuple' ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_361_31to32:
   [
   St( ~pid, 'tgk31', 'empty_tuple' ), Fr( ~UN_251 ),
   !Value_35( $amount, value_250 )
   ]
  --[ OneTerminal_245( ), Role_48( $Terminal, 'Terminal' ) ]->
   [
   St( ~pid, 'tgk32',
       <<$amount, 'Switzerland', 'CHF', 'YYMMDD', 'Purchase', ~UN_251>, 
        $Terminal>
   ),
   Out( <'GET_PROCESSING_OPTIONS', $amount, 'Switzerland', 'CHF', 'YYMMDD', 
         'Purchase', ~UN_251>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_361_32to33:
   [ St( ~pid, 'tgk32', <tgc_PDOL_0, $Terminal> ), In( <AIP_257, 'AFL'> ) ]
  -->
   [
   St( ~pid, 'tgk33', <AIP_257, tgc_PDOL_0, $Terminal> ),
   Out( <'READ_RECORD', 'AFL'> )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_361_33to34:
   [
   St( ~pid, 'tgk33', <<'SDA', furtherData_262>, tgc_PDOL_0, $Terminal> ),
   In( <~PAN_265, expDate_263, $CA, 
        <<'02', $Bank, pubkBank_261, $CA>, sign2_258>, SSAD_264, CVM_266>
   ),
   !IssuingCA_58( $Bank, $CA ),
   !CertCA_50( $CA, <<'01', $CA, pubkCA_260, $CA>, sign1_259> )
   ]
  --[
  Eq_27( verify(sign1_259, <'01', $CA, pubkCA_260, $CA>, pubkCA_260), true
  ),
  Eq_27( verify(sign2_258, <'02', $Bank, pubkBank_261, $CA>, pubkCA_260),
         true
  ),
  Eq_27( verify(SSAD_264,
                <'03', ~PAN_265, expDate_263, 'SDA', furtherData_262>, pubkBank_261),
         true
  )
  ]->
   [
   St( ~pid, 'tgk34',
       <<'SDA', furtherData_262>, CVM_266, ~PAN_265, tgc_PDOL_0, $Terminal, 
        $Bank, $CA, pubkBank_261, 'Null'>
   )
   ]

  /*
  rule (modulo AC) TgRuleTerminal_361_33to34:
     [
     St( ~pid, 'tgk33', <<'SDA', furtherData_262>, tgc_PDOL_0, $Terminal> ),
     In( <~PAN_265, expDate_263, $CA, 
          <<'02', $Bank, pubkBank_261, $CA>, sign2_258>, SSAD_264, CVM_266>
     ),
     !IssuingCA_58( $Bank, $CA ),
     !CertCA_50( $CA, <<'01', $CA, pubkCA_260, $CA>, sign1_259> )
     ]
    --[ Eq_27( z, true ), Eq_27( z.1, true ), Eq_27( z.2, true ) ]->
     [
     St( ~pid, 'tgk34',
         <<'SDA', furtherData_262>, CVM_266, ~PAN_265, tgc_PDOL_0, $Terminal, 
          $Bank, $CA, pubkBank_261, 'Null'>
     )
     ]
    variants (modulo AC)
    1. $Bank = $Bank.37
       $CA   = $CA.38
       ~PAN_265
             = ~PAN_265.40
       SSAD_264
             = SSAD_264.43
       expDate_263
             = expDate_263.44
       furtherData_262
             = furtherData_262.45
       pubkBank_261
             = pubkBank_261.46
       pubkCA_260
             = pubkCA_260.47
       sign1_259
             = sign1_259.48
       sign2_258
             = sign2_258.49
       z     = verify(sign1_259.48, <'01', $CA.38, pubkCA_260.47, $CA.38>,
                      pubkCA_260.47)
       z.1   = verify(sign2_258.49, <'02', $Bank.37, pubkBank_261.46, $CA.38>,
                      pubkCA_260.47)
       z.2   = verify(SSAD_264.43,
                      <'03', ~PAN_265.40, expDate_263.44, 'SDA', furtherData_262.45>,
                      pubkBank_261.46)
    
    2. $Bank = $Bank.145
       $CA   = $CA.146
       ~PAN_265
             = ~PAN_265.148
       SSAD_264
             = sign(<'03', ~PAN_265.148, expDate_263.152, 'SDA', furtherData_262.153>,
                    x.288)
       expDate_263
             = expDate_263.152
       furtherData_262
             = furtherData_262.153
       pubkBank_261
             = pk(x.288)
       pubkCA_260
             = pubkCA_260.155
       sign1_259
             = sign1_259.156
       sign2_258
             = sign2_258.157
       z     = verify(sign1_259.156, <'01', $CA.146, pubkCA_260.155, $CA.146>,
                      pubkCA_260.155)
       z.1   = verify(sign2_258.157, <'02', $Bank.145, pk(x.288), $CA.146>,
                      pubkCA_260.155)
       z.2   = true
    
    3. $Bank = $Bank.148
       $CA   = $CA.149
       ~PAN_265
             = ~PAN_265.151
       SSAD_264
             = sign(<'03', ~PAN_265.151, expDate_263.155, 'SDA', furtherData_262.156>,
                    x.293)
       expDate_263
             = expDate_263.155
       furtherData_262
             = furtherData_262.156
       pubkBank_261
             = pk(x.293)
       pubkCA_260
             = pk(x.294)
       sign1_259
             = sign(<'01', $CA.149, pk(x.294), $CA.149>, x.294)
       sign2_258
             = sign2_258.160
       z     = true
       z.1   = verify(sign2_258.160, <'02', $Bank.148, pk(x.293), $CA.149>,
                      pk(x.294))
       z.2   = true
    
    4. $Bank = $Bank.149
       $CA   = $CA.150
       ~PAN_265
             = ~PAN_265.152
       SSAD_264
             = SSAD_264.155
       expDate_263
             = expDate_263.156
       furtherData_262
             = furtherData_262.157
       pubkBank_261
             = pubkBank_261.158
       pubkCA_260
             = pk(x.296)
       sign1_259
             = sign(<'01', $CA.150, pk(x.296), $CA.150>, x.296)
       sign2_258
             = sign2_258.161
       z     = true
       z.1   = verify(sign2_258.161,
                      <'02', $Bank.149, pubkBank_261.158, $CA.150>, pk(x.296))
       z.2   = verify(SSAD_264.155,
                      <'03', ~PAN_265.152, expDate_263.156, 'SDA', furtherData_262.157>,
                      pubkBank_261.158)
    
    5. $Bank = $Bank.149
       $CA   = $CA.150
       ~PAN_265
             = ~PAN_265.152
       SSAD_264
             = sign(<'03', ~PAN_265.152, expDate_263.156, 'SDA', furtherData_262.157>,
                    x.295)
       expDate_263
             = expDate_263.156
       furtherData_262
             = furtherData_262.157
       pubkBank_261
             = pk(x.295)
       pubkCA_260
             = pk(x.296)
       sign1_259
             = sign1_259.160
       sign2_258
             = sign(<'02', $Bank.149, pk(x.295), $CA.150>, x.296)
       z     = verify(sign1_259.160, <'01', $CA.150, pk(x.296), $CA.150>,
                      pk(x.296))
       z.1   = true
       z.2   = true
    
    6. $Bank = $Bank.149
       $CA   = $CA.150
       ~PAN_265
             = ~PAN_265.152
       SSAD_264
             = sign(<'03', ~PAN_265.152, expDate_263.156, 'SDA', furtherData_262.157>,
                    x.295)
       expDate_263
             = expDate_263.156
       furtherData_262
             = furtherData_262.157
       pubkBank_261
             = pk(x.295)
       pubkCA_260
             = pk(x.296)
       sign1_259
             = sign(<'01', $CA.150, pk(x.296), $CA.150>, x.296)
       sign2_258
             = sign(<'02', $Bank.149, pk(x.295), $CA.150>, x.296)
       z     = true
       z.1   = true
       z.2   = true
    
    7. $Bank = $Bank.150
       $CA   = $CA.151
       ~PAN_265
             = ~PAN_265.153
       SSAD_264
             = SSAD_264.156
       expDate_263
             = expDate_263.157
       furtherData_262
             = furtherData_262.158
       pubkBank_261
             = pubkBank_261.159
       pubkCA_260
             = pk(x.298)
       sign1_259
             = sign1_259.161
       sign2_258
             = sign(<'02', $Bank.150, pubkBank_261.159, $CA.151>, x.298)
       z     = verify(sign1_259.161, <'01', $CA.151, pk(x.298), $CA.151>,
                      pk(x.298))
       z.1   = true
       z.2   = verify(SSAD_264.156,
                      <'03', ~PAN_265.153, expDate_263.157, 'SDA', furtherData_262.158>,
                      pubkBank_261.159)
    
    8. $Bank = $Bank.150
       $CA   = $CA.151
       ~PAN_265
             = ~PAN_265.153
       SSAD_264
             = SSAD_264.156
       expDate_263
             = expDate_263.157
       furtherData_262
             = furtherData_262.158
       pubkBank_261
             = pubkBank_261.159
       pubkCA_260
             = pk(x.298)
       sign1_259
             = sign(<'01', $CA.151, pk(x.298), $CA.151>, x.298)
       sign2_258
             = sign(<'02', $Bank.150, pubkBank_261.159, $CA.151>, x.298)
       z     = true
       z.1   = true
       z.2   = verify(SSAD_264.156,
                      <'03', ~PAN_265.153, expDate_263.157, 'SDA', furtherData_262.158>,
                      pubkBank_261.159)
  */

rule (modulo E) TgRuleTerminal_361_33to35:
   [
   St( ~pid, 'tgk33', <<'CDA', furtherData_274>, tgc_PDOL_0, $Terminal> ),
   In( <~PAN_276, expDate_275, $CA, 
        <<'02', $Bank, pubkBank_273, $CA>, sign2_269>, 
        <<'04', ~PAN_276, pubkCard_271, $Bank, CVM_277, 'CDA', furtherData_274>, 
         sign3_268>, 
        CVM_277>
   ),
   !IssuingCA_58( $Bank, $CA ),
   !CertCA_50( $CA, <<'01', $CA, pubkCA_272, $CA>, sign1_270> )
   ]
  --[
  Eq_27( verify(sign1_270, <'01', $CA, pubkCA_272, $CA>, pubkCA_272), true
  ),
  Eq_27( verify(sign2_269, <'02', $Bank, pubkBank_273, $CA>, pubkCA_272),
         true
  ),
  Eq_27( verify(sign3_268,
                <'04', ~PAN_276, pubkCard_271, $Bank, CVM_277, 'CDA', furtherData_274>,
                pubkBank_273),
         true
  )
  ]->
   [
   St( ~pid, 'tgk35',
       <<'CDA', furtherData_274>, CVM_277, ~PAN_276, tgc_PDOL_0, $Terminal, 
        $Bank, $CA, pubkBank_273, pubkCard_271>
   )
   ]

  /*
  rule (modulo AC) TgRuleTerminal_361_33to35:
     [
     St( ~pid, 'tgk33', <<'CDA', furtherData_274>, tgc_PDOL_0, $Terminal> ),
     In( <~PAN_276, expDate_275, $CA, 
          <<'02', $Bank, pubkBank_273, $CA>, sign2_269>, 
          <<'04', ~PAN_276, pubkCard_271, $Bank, CVM_277, 'CDA', furtherData_274>, 
           sign3_268>, 
          CVM_277>
     ),
     !IssuingCA_58( $Bank, $CA ),
     !CertCA_50( $CA, <<'01', $CA, pubkCA_272, $CA>, sign1_270> )
     ]
    --[ Eq_27( z, true ), Eq_27( z.1, true ), Eq_27( z.2, true ) ]->
     [
     St( ~pid, 'tgk35',
         <<'CDA', furtherData_274>, CVM_277, ~PAN_276, tgc_PDOL_0, $Terminal, 
          $Bank, $CA, pubkBank_273, pubkCard_271>
     )
     ]
    variants (modulo AC)
    1. $Bank = $Bank.39
       $CA   = $CA.40
       ~PAN_276
             = ~PAN_276.42
       CVM_277
             = CVM_277.44
       furtherData_274
             = furtherData_274.46
       pubkBank_273
             = pubkBank_273.47
       pubkCA_272
             = pubkCA_272.48
       pubkCard_271
             = pubkCard_271.49
       sign1_270
             = sign1_270.50
       sign2_269
             = sign2_269.51
       sign3_268
             = sign3_268.52
       z     = verify(sign1_270.50, <'01', $CA.40, pubkCA_272.48, $CA.40>,
                      pubkCA_272.48)
       z.1   = verify(sign2_269.51, <'02', $Bank.39, pubkBank_273.47, $CA.40>,
                      pubkCA_272.48)
       z.2   = verify(sign3_268.52,
                      <'04', ~PAN_276.42, pubkCard_271.49, $Bank.39, CVM_277.44, 'CDA', 
                       furtherData_274.46>,
                      pubkBank_273.47)
    
    2. $Bank = $Bank.154
       $CA   = $CA.155
       ~PAN_276
             = ~PAN_276.157
       CVM_277
             = CVM_277.159
       furtherData_274
             = furtherData_274.161
       pubkBank_273
             = pubkBank_273.162
       pubkCA_272
             = pk(x.306)
       pubkCard_271
             = pubkCard_271.164
       sign1_270
             = sign(<'01', $CA.155, pk(x.306), $CA.155>, x.306)
       sign2_269
             = sign2_269.166
       sign3_268
             = sign3_268.167
       z     = true
       z.1   = verify(sign2_269.166,
                      <'02', $Bank.154, pubkBank_273.162, $CA.155>, pk(x.306))
       z.2   = verify(sign3_268.167,
                      <'04', ~PAN_276.157, pubkCard_271.164, $Bank.154, CVM_277.159, 'CDA', 
                       furtherData_274.161>,
                      pubkBank_273.162)
    
    3. $Bank = $Bank.154
       $CA   = $CA.155
       ~PAN_276
             = ~PAN_276.157
       CVM_277
             = CVM_277.159
       furtherData_274
             = furtherData_274.161
       pubkBank_273
             = pk(x.306)
       pubkCA_272
             = pubkCA_272.163
       pubkCard_271
             = pubkCard_271.164
       sign1_270
             = sign1_270.165
       sign2_269
             = sign2_269.166
       sign3_268
             = sign(<'04', ~PAN_276.157, pubkCard_271.164, $Bank.154, CVM_277.159, 
                     'CDA', furtherData_274.161>,
                    x.306)
       z     = verify(sign1_270.165, <'01', $CA.155, pubkCA_272.163, $CA.155>,
                      pubkCA_272.163)
       z.1   = verify(sign2_269.166, <'02', $Bank.154, pk(x.306), $CA.155>,
                      pubkCA_272.163)
       z.2   = true
    
    4. $Bank = $Bank.155
       $CA   = $CA.156
       ~PAN_276
             = ~PAN_276.158
       CVM_277
             = CVM_277.160
       furtherData_274
             = furtherData_274.162
       pubkBank_273
             = pubkBank_273.163
       pubkCA_272
             = pk(x.308)
       pubkCard_271
             = pubkCard_271.165
       sign1_270
             = sign1_270.166
       sign2_269
             = sign(<'02', $Bank.155, pubkBank_273.163, $CA.156>, x.308)
       sign3_268
             = sign3_268.168
       z     = verify(sign1_270.166, <'01', $CA.156, pk(x.308), $CA.156>,
                      pk(x.308))
       z.1   = true
       z.2   = verify(sign3_268.168,
                      <'04', ~PAN_276.158, pubkCard_271.165, $Bank.155, CVM_277.160, 'CDA', 
                       furtherData_274.162>,
                      pubkBank_273.163)
    
    5. $Bank = $Bank.155
       $CA   = $CA.156
       ~PAN_276
             = ~PAN_276.158
       CVM_277
             = CVM_277.160
       furtherData_274
             = furtherData_274.162
       pubkBank_273
             = pubkBank_273.163
       pubkCA_272
             = pk(x.308)
       pubkCard_271
             = pubkCard_271.165
       sign1_270
             = sign(<'01', $CA.156, pk(x.308), $CA.156>, x.308)
       sign2_269
             = sign(<'02', $Bank.155, pubkBank_273.163, $CA.156>, x.308)
       sign3_268
             = sign3_268.168
       z     = true
       z.1   = true
       z.2   = verify(sign3_268.168,
                      <'04', ~PAN_276.158, pubkCard_271.165, $Bank.155, CVM_277.160, 'CDA', 
                       furtherData_274.162>,
                      pubkBank_273.163)
    
    6. $Bank = $Bank.155
       $CA   = $CA.156
       ~PAN_276
             = ~PAN_276.158
       CVM_277
             = CVM_277.160
       furtherData_274
             = furtherData_274.162
       pubkBank_273
             = pk(x.307)
       pubkCA_272
             = pk(x.308)
       pubkCard_271
             = pubkCard_271.165
       sign1_270
             = sign1_270.166
       sign2_269
             = sign(<'02', $Bank.155, pk(x.307), $CA.156>, x.308)
       sign3_268
             = sign(<'04', ~PAN_276.158, pubkCard_271.165, $Bank.155, CVM_277.160, 
                     'CDA', furtherData_274.162>,
                    x.307)
       z     = verify(sign1_270.166, <'01', $CA.156, pk(x.308), $CA.156>,
                      pk(x.308))
       z.1   = true
       z.2   = true
    
    7. $Bank = $Bank.155
       $CA   = $CA.156
       ~PAN_276
             = ~PAN_276.158
       CVM_277
             = CVM_277.160
       furtherData_274
             = furtherData_274.162
       pubkBank_273
             = pk(x.307)
       pubkCA_272
             = pk(x.308)
       pubkCard_271
             = pubkCard_271.165
       sign1_270
             = sign(<'01', $CA.156, pk(x.308), $CA.156>, x.308)
       sign2_269
             = sign2_269.167
       sign3_268
             = sign(<'04', ~PAN_276.158, pubkCard_271.165, $Bank.155, CVM_277.160, 
                     'CDA', furtherData_274.162>,
                    x.307)
       z     = true
       z.1   = verify(sign2_269.167, <'02', $Bank.155, pk(x.307), $CA.156>,
                      pk(x.308))
       z.2   = true
    
    8. $Bank = $Bank.155
       $CA   = $CA.156
       ~PAN_276
             = ~PAN_276.158
       CVM_277
             = CVM_277.160
       furtherData_274
             = furtherData_274.162
       pubkBank_273
             = pk(x.307)
       pubkCA_272
             = pk(x.308)
       pubkCard_271
             = pubkCard_271.165
       sign1_270
             = sign(<'01', $CA.156, pk(x.308), $CA.156>, x.308)
       sign2_269
             = sign(<'02', $Bank.155, pk(x.307), $CA.156>, x.308)
       sign3_268
             = sign(<'04', ~PAN_276.158, pubkCard_271.165, $Bank.155, CVM_277.160, 
                     'CDA', furtherData_274.162>,
                    x.307)
       z     = true
       z.1   = true
       z.2   = true
  */

rule (modulo E) TgRuleTerminal_361_33to36:
   [
   St( ~pid, 'tgk33', <<'DDA', furtherData_285>, tgc_PDOL_0, $Terminal> ),
   !IssuingCA_58( $Bank, $CA ),
   In( <~PAN_287, expDate_286, $CA, 
        <<'02', $Bank, pubkBank_284, $CA>, sign2_280>, 
        <<'04', ~PAN_287, pubkCard_282, $Bank, CVM_288, 'DDA', furtherData_285>, 
         sign3_279>, 
        CVM_288>
   ),
   !CertCA_50( $CA, <<'01', $CA, pubkCA_283, $CA>, sign1_281> )
   ]
  --[
  Eq_27( verify(sign1_281, <'01', $CA, pubkCA_283, $CA>, pubkCA_283), true
  ),
  Eq_27( verify(sign2_280, <'02', $Bank, pubkBank_284, $CA>, pubkCA_283),
         true
  ),
  Eq_27( verify(sign3_279,
                <'04', ~PAN_287, pubkCard_282, $Bank, CVM_288, 'DDA', furtherData_285>,
                pubkBank_284),
         true
  )
  ]->
   [
   St( ~pid, 'tgk36',
       <<'DDA', furtherData_285>, CVM_288, ~PAN_287, tgc_PDOL_0, $Terminal, 
        $Bank, $CA, pubkBank_284, pubkCard_282>
   )
   ]

  /*
  rule (modulo AC) TgRuleTerminal_361_33to36:
     [
     St( ~pid, 'tgk33', <<'DDA', furtherData_285>, tgc_PDOL_0, $Terminal> ),
     !IssuingCA_58( $Bank, $CA ),
     In( <~PAN_287, expDate_286, $CA, 
          <<'02', $Bank, pubkBank_284, $CA>, sign2_280>, 
          <<'04', ~PAN_287, pubkCard_282, $Bank, CVM_288, 'DDA', furtherData_285>, 
           sign3_279>, 
          CVM_288>
     ),
     !CertCA_50( $CA, <<'01', $CA, pubkCA_283, $CA>, sign1_281> )
     ]
    --[ Eq_27( z, true ), Eq_27( z.1, true ), Eq_27( z.2, true ) ]->
     [
     St( ~pid, 'tgk36',
         <<'DDA', furtherData_285>, CVM_288, ~PAN_287, tgc_PDOL_0, $Terminal, 
          $Bank, $CA, pubkBank_284, pubkCard_282>
     )
     ]
    variants (modulo AC)
    1. $Bank = $Bank.39
       $CA   = $CA.40
       ~PAN_287
             = ~PAN_287.42
       CVM_288
             = CVM_288.44
       furtherData_285
             = furtherData_285.46
       pubkBank_284
             = pubkBank_284.47
       pubkCA_283
             = pubkCA_283.48
       pubkCard_282
             = pubkCard_282.49
       sign1_281
             = sign1_281.50
       sign2_280
             = sign2_280.51
       sign3_279
             = sign3_279.52
       z     = verify(sign1_281.50, <'01', $CA.40, pubkCA_283.48, $CA.40>,
                      pubkCA_283.48)
       z.1   = verify(sign2_280.51, <'02', $Bank.39, pubkBank_284.47, $CA.40>,
                      pubkCA_283.48)
       z.2   = verify(sign3_279.52,
                      <'04', ~PAN_287.42, pubkCard_282.49, $Bank.39, CVM_288.44, 'DDA', 
                       furtherData_285.46>,
                      pubkBank_284.47)
    
    2. $Bank = $Bank.154
       $CA   = $CA.155
       ~PAN_287
             = ~PAN_287.157
       CVM_288
             = CVM_288.159
       furtherData_285
             = furtherData_285.161
       pubkBank_284
             = pubkBank_284.162
       pubkCA_283
             = pk(x.306)
       pubkCard_282
             = pubkCard_282.164
       sign1_281
             = sign(<'01', $CA.155, pk(x.306), $CA.155>, x.306)
       sign2_280
             = sign2_280.166
       sign3_279
             = sign3_279.167
       z     = true
       z.1   = verify(sign2_280.166,
                      <'02', $Bank.154, pubkBank_284.162, $CA.155>, pk(x.306))
       z.2   = verify(sign3_279.167,
                      <'04', ~PAN_287.157, pubkCard_282.164, $Bank.154, CVM_288.159, 'DDA', 
                       furtherData_285.161>,
                      pubkBank_284.162)
    
    3. $Bank = $Bank.154
       $CA   = $CA.155
       ~PAN_287
             = ~PAN_287.157
       CVM_288
             = CVM_288.159
       furtherData_285
             = furtherData_285.161
       pubkBank_284
             = pk(x.306)
       pubkCA_283
             = pubkCA_283.163
       pubkCard_282
             = pubkCard_282.164
       sign1_281
             = sign1_281.165
       sign2_280
             = sign2_280.166
       sign3_279
             = sign(<'04', ~PAN_287.157, pubkCard_282.164, $Bank.154, CVM_288.159, 
                     'DDA', furtherData_285.161>,
                    x.306)
       z     = verify(sign1_281.165, <'01', $CA.155, pubkCA_283.163, $CA.155>,
                      pubkCA_283.163)
       z.1   = verify(sign2_280.166, <'02', $Bank.154, pk(x.306), $CA.155>,
                      pubkCA_283.163)
       z.2   = true
    
    4. $Bank = $Bank.155
       $CA   = $CA.156
       ~PAN_287
             = ~PAN_287.158
       CVM_288
             = CVM_288.160
       furtherData_285
             = furtherData_285.162
       pubkBank_284
             = pubkBank_284.163
       pubkCA_283
             = pk(x.308)
       pubkCard_282
             = pubkCard_282.165
       sign1_281
             = sign1_281.166
       sign2_280
             = sign(<'02', $Bank.155, pubkBank_284.163, $CA.156>, x.308)
       sign3_279
             = sign3_279.168
       z     = verify(sign1_281.166, <'01', $CA.156, pk(x.308), $CA.156>,
                      pk(x.308))
       z.1   = true
       z.2   = verify(sign3_279.168,
                      <'04', ~PAN_287.158, pubkCard_282.165, $Bank.155, CVM_288.160, 'DDA', 
                       furtherData_285.162>,
                      pubkBank_284.163)
    
    5. $Bank = $Bank.155
       $CA   = $CA.156
       ~PAN_287
             = ~PAN_287.158
       CVM_288
             = CVM_288.160
       furtherData_285
             = furtherData_285.162
       pubkBank_284
             = pubkBank_284.163
       pubkCA_283
             = pk(x.308)
       pubkCard_282
             = pubkCard_282.165
       sign1_281
             = sign(<'01', $CA.156, pk(x.308), $CA.156>, x.308)
       sign2_280
             = sign(<'02', $Bank.155, pubkBank_284.163, $CA.156>, x.308)
       sign3_279
             = sign3_279.168
       z     = true
       z.1   = true
       z.2   = verify(sign3_279.168,
                      <'04', ~PAN_287.158, pubkCard_282.165, $Bank.155, CVM_288.160, 'DDA', 
                       furtherData_285.162>,
                      pubkBank_284.163)
    
    6. $Bank = $Bank.155
       $CA   = $CA.156
       ~PAN_287
             = ~PAN_287.158
       CVM_288
             = CVM_288.160
       furtherData_285
             = furtherData_285.162
       pubkBank_284
             = pk(x.307)
       pubkCA_283
             = pk(x.308)
       pubkCard_282
             = pubkCard_282.165
       sign1_281
             = sign1_281.166
       sign2_280
             = sign(<'02', $Bank.155, pk(x.307), $CA.156>, x.308)
       sign3_279
             = sign(<'04', ~PAN_287.158, pubkCard_282.165, $Bank.155, CVM_288.160, 
                     'DDA', furtherData_285.162>,
                    x.307)
       z     = verify(sign1_281.166, <'01', $CA.156, pk(x.308), $CA.156>,
                      pk(x.308))
       z.1   = true
       z.2   = true
    
    7. $Bank = $Bank.155
       $CA   = $CA.156
       ~PAN_287
             = ~PAN_287.158
       CVM_288
             = CVM_288.160
       furtherData_285
             = furtherData_285.162
       pubkBank_284
             = pk(x.307)
       pubkCA_283
             = pk(x.308)
       pubkCard_282
             = pubkCard_282.165
       sign1_281
             = sign(<'01', $CA.156, pk(x.308), $CA.156>, x.308)
       sign2_280
             = sign2_280.167
       sign3_279
             = sign(<'04', ~PAN_287.158, pubkCard_282.165, $Bank.155, CVM_288.160, 
                     'DDA', furtherData_285.162>,
                    x.307)
       z     = true
       z.1   = verify(sign2_280.167, <'02', $Bank.155, pk(x.307), $CA.156>,
                      pk(x.308))
       z.2   = true
    
    8. $Bank = $Bank.155
       $CA   = $CA.156
       ~PAN_287
             = ~PAN_287.158
       CVM_288
             = CVM_288.160
       furtherData_285
             = furtherData_285.162
       pubkBank_284
             = pk(x.307)
       pubkCA_283
             = pk(x.308)
       pubkCard_282
             = pubkCard_282.165
       sign1_281
             = sign(<'01', $CA.156, pk(x.308), $CA.156>, x.308)
       sign2_280
             = sign(<'02', $Bank.155, pk(x.307), $CA.156>, x.308)
       sign3_279
             = sign(<'04', ~PAN_287.158, pubkCard_282.165, $Bank.155, CVM_288.160, 
                     'DDA', furtherData_285.162>,
                    x.307)
       z     = true
       z.1   = true
       z.2   = true
  */

rule (modulo E) TgRuleTerminal_361_34to39:
   [
   St( ~pid, 'tgk34',
       <tgc_AIP_0, tgc_CVM_0, tgc_PAN_0, tgc_PDOL_0, tgc_Role0_0, tgc_Role1_0, 
        tgc_Role2_0, tgc_pubkBank_0, tgc_pubkCard_0>
   )
   ]
  -->
   [
   St( ~pid, 'tgk39',
       <tgc_AIP_0, tgc_CVM_0, tgc_PAN_0, tgc_PDOL_0, tgc_Role0_0, tgc_Role1_0, 
        tgc_Role2_0, tgc_pubkBank_0, tgc_pubkCard_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_361_35to39:
   [
   St( ~pid, 'tgk35',
       <tgc_AIP_0, tgc_CVM_0, tgc_PAN_0, tgc_PDOL_0, tgc_Role0_0, tgc_Role1_0, 
        tgc_Role2_0, tgc_pubkBank_0, tgc_pubkCard_0>
   )
   ]
  -->
   [
   St( ~pid, 'tgk39',
       <tgc_AIP_0, tgc_CVM_0, tgc_PAN_0, tgc_PDOL_0, tgc_Role0_0, tgc_Role1_0, 
        tgc_Role2_0, tgc_pubkBank_0, tgc_pubkCard_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_361_36to37:
   [
   St( ~pid, 'tgk36',
       <tgc_AIP_0, tgc_CVM_0, ~u_tgany16_294, 
        <$amount, country_293, currency_292, date_291, type_290, ~UN_295>, 
        $Terminal, $Bank, $CA, tgc_pubkBank_0, tgc_pubkCard_0>
   )
   ]
  -->
   [
   St( ~pid, 'tgk37',
       <tgc_AIP_0, tgc_CVM_0, ~u_tgany16_294, 
        <$amount, country_293, currency_292, date_291, type_290, ~UN_295>, 
        $Terminal, $Bank, $CA, tgc_pubkBank_0, tgc_pubkCard_0>
   ),
   Out( <'INTERNAL_AUTHENTICATE', ~UN_295> )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_361_37to38:
   [
   St( ~pid, 'tgk37',
       <tgc_AIP_0, tgc_CVM_0, ~u_tgany15_302, 
        <$amount, country_301, currency_300, date_299, type_297, ~UN_303>, 
        $Terminal, $Bank, $CA, tgc_pubkBank_0, tgc_pubkCard_0>
   ),
   In( <nc_298, SDAD_304> )
   ]
  --[
  Eq_27( verify(SDAD_304, <'05', nc_298, ~UN_303>, tgc_pubkCard_0), true )
  ]->
   [
   St( ~pid, 'tgk38',
       <tgc_AIP_0, tgc_CVM_0, ~u_tgany15_302, 
        <$amount, country_301, currency_300, date_299, type_297, ~UN_303>, 
        $Terminal, $Bank, $CA, tgc_pubkBank_0, tgc_pubkCard_0>
   )
   ]

  /*
  rule (modulo AC) TgRuleTerminal_361_37to38:
     [
     St( ~pid, 'tgk37',
         <tgc_AIP_0, tgc_CVM_0, ~u_tgany15_302, 
          <$amount, country_301, currency_300, date_299, type_297, ~UN_303>, 
          $Terminal, $Bank, $CA, tgc_pubkBank_0, tgc_pubkCard_0>
     ),
     In( <nc_298, SDAD_304> )
     ]
    --[ Eq_27( z, true ) ]->
     [
     St( ~pid, 'tgk38',
         <tgc_AIP_0, tgc_CVM_0, ~u_tgany15_302, 
          <$amount, country_301, currency_300, date_299, type_297, ~UN_303>, 
          $Terminal, $Bank, $CA, tgc_pubkBank_0, tgc_pubkCard_0>
     )
     ]
    variants (modulo AC)
    1. ~UN_303
             = ~UN_303.33
       SDAD_304
             = SDAD_304.36
       nc_298
             = nc_298.40
       tgc_pubkCard_0
             = tgc_pubkCard_0.44
       z     = verify(SDAD_304.36, <'05', nc_298.40, ~UN_303.33>,
                      tgc_pubkCard_0.44)
    
    2. ~UN_303
             = ~UN_303.42
       SDAD_304
             = sign(<'05', nc_298.49, ~UN_303.42>, x.78)
       nc_298
             = nc_298.49
       tgc_pubkCard_0
             = pk(x.78)
       z     = true
  */

rule (modulo E) TgRuleTerminal_361_38to39:
   [
   St( ~pid, 'tgk38',
       <tgc_AIP_0, tgc_CVM_0, tgc_PAN_0, tgc_PDOL_0, tgc_Role0_0, tgc_Role1_0, 
        tgc_Role2_0, tgc_pubkBank_0, tgc_pubkCard_0>
   )
   ]
  -->
   [
   St( ~pid, 'tgk39',
       <tgc_AIP_0, tgc_CVM_0, tgc_PAN_0, tgc_PDOL_0, tgc_Role0_0, tgc_Role1_0, 
        tgc_Role2_0, tgc_pubkBank_0, tgc_pubkCard_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_361_39to40:
   [
   St( ~pid, 'tgk39',
       <tgc_AIP_0, tgc_CVM_0, ~u_tgany12_309, 
        <$amount, country_308, currency_307, date_306, type_305, ~UN_310>, 
        $Terminal, $Bank, $CA, tgc_pubkBank_0, tgc_pubkCard_0>
   ),
   !Value_35( $amount, 'Low' )
   ]
  -->
   [
   St( ~pid, 'tgk40',
       <tgc_AIP_0, 'NoPIN', ~u_tgany12_309, 
        <$amount, country_308, currency_307, date_306, type_305, ~UN_310>, 
        $Terminal, $Bank, $CA, 'Null', tgc_pubkCard_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_361_39to41:
   [
   St( ~pid, 'tgk39',
       <tgc_AIP_0, 'OnlinePIN', ~u_tgany13_315, 
        <$amount, country_314, currency_313, date_312, type_311, ~UN_316>, 
        $Terminal, $Bank, $CA, tgc_pubkBank_0, tgc_pubkCard_0>
   ),
   !Entered_PIN_84( ~u_tgany13_315, PIN_317 ), !Value_35( $amount, 'High' )
   ]
  -->
   [
   St( ~pid, 'tgk41',
       <tgc_AIP_0, 'OnlinePIN', ~u_tgany13_315, 
        <$amount, country_314, currency_313, date_312, type_311, ~UN_316>, 
        $Terminal, $Bank, $CA, aenc(PIN_317, tgc_pubkBank_0), tgc_pubkCard_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_361_39to42:
   [
   St( ~pid, 'tgk39',
       <<auth_323, 'ODCVM', furtherData2_319>, tgc_CVM_0, ~u_tgany14_324, 
        <$amount, country_322, currency_321, date_320, type_318, ~UN_325>, 
        $Terminal, $Bank, $CA, tgc_pubkBank_0, tgc_pubkCard_0>
   ),
   !Value_35( $amount, 'High' )
   ]
  -->
   [
   St( ~pid, 'tgk42',
       <<auth_323, 'ODCVM', furtherData2_319>, 'ODCVM', ~u_tgany14_324, 
        <$amount, country_322, currency_321, date_320, type_318, ~UN_325>, 
        $Terminal, $Bank, $CA, 'Null', tgc_pubkCard_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_361_40to43:
   [
   St( ~pid, 'tgk40',
       <tgc_AIP_0, tgc_CVM_0, tgc_PAN_0, tgc_PDOL_0, tgc_Role0_0, tgc_Role1_0, 
        tgc_Role2_0, tgc_encPIN_0, tgc_pubkCard_0>
   )
   ]
  -->
   [
   St( ~pid, 'tgk43',
       <tgc_AIP_0, tgc_CVM_0, tgc_PAN_0, tgc_PDOL_0, tgc_Role0_0, tgc_Role1_0, 
        tgc_Role2_0, tgc_encPIN_0, tgc_pubkCard_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_361_41to43:
   [
   St( ~pid, 'tgk41',
       <tgc_AIP_0, tgc_CVM_0, tgc_PAN_0, tgc_PDOL_0, tgc_Role0_0, tgc_Role1_0, 
        tgc_Role2_0, tgc_encPIN_0, tgc_pubkCard_0>
   )
   ]
  -->
   [
   St( ~pid, 'tgk43',
       <tgc_AIP_0, tgc_CVM_0, tgc_PAN_0, tgc_PDOL_0, tgc_Role0_0, tgc_Role1_0, 
        tgc_Role2_0, tgc_encPIN_0, tgc_pubkCard_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_361_42to43:
   [
   St( ~pid, 'tgk42',
       <tgc_AIP_0, tgc_CVM_0, tgc_PAN_0, tgc_PDOL_0, tgc_Role0_0, tgc_Role1_0, 
        tgc_Role2_0, tgc_encPIN_0, tgc_pubkCard_0>
   )
   ]
  -->
   [
   St( ~pid, 'tgk43',
       <tgc_AIP_0, tgc_CVM_0, tgc_PAN_0, tgc_PDOL_0, tgc_Role0_0, tgc_Role1_0, 
        tgc_Role2_0, tgc_encPIN_0, tgc_pubkCard_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_361_43to44:
   [
   St( ~pid, 'tgk43',
       <tgc_AIP_0, tgc_CVM_0, ~u_tgany8_327, tgc_PDOL_0, $Terminal, $Bank, $CA, 
        tgc_encPIN_0, tgc_pubkCard_0>
   ),
   In( acType_326 )
   ]
  --[ NEq_26( fst(tgc_AIP_0), 'CDA' ) ]->
   [
   St( ~pid, 'tgk44',
       <tgc_AIP_0, tgc_CVM_0, ~u_tgany8_327, $Terminal, $Bank, $CA, 
        <tgc_PDOL_0, 'TVR', tgc_CVM_0, 'HHMMSS'>, acType_326, tgc_encPIN_0>
   ),
   Out( <'GENERATE_AC', acType_326, 'NoCDA', 'TVR', tgc_CVM_0, 'HHMMSS'> )
   ]

  /*
  rule (modulo AC) TgRuleTerminal_361_43to44:
     [
     St( ~pid, 'tgk43',
         <tgc_AIP_0, tgc_CVM_0, ~u_tgany8_327, tgc_PDOL_0, $Terminal, $Bank, $CA, 
          tgc_encPIN_0, tgc_pubkCard_0>
     ),
     In( acType_326 )
     ]
    --[ NEq_26( z, 'CDA' ) ]->
     [
     St( ~pid, 'tgk44',
         <tgc_AIP_0, tgc_CVM_0, ~u_tgany8_327, $Terminal, $Bank, $CA, 
          <tgc_PDOL_0, 'TVR', tgc_CVM_0, 'HHMMSS'>, acType_326, tgc_encPIN_0>
     ),
     Out( <'GENERATE_AC', acType_326, 'NoCDA', 'TVR', tgc_CVM_0, 'HHMMSS'> )
     ]
    variants (modulo AC)
    1. tgc_AIP_0
             = tgc_AIP_0.20
       z     = fst(tgc_AIP_0.20)
    
    2. tgc_AIP_0
             = <z.33, x.47>
       z     = z.33
  */

rule (modulo E) TgRuleTerminal_361_43to46:
   [
   St( ~pid, 'tgk43',
       <<'CDA', u_furtherData_341>, tgc_CVM_0, ~u_tgany11_340, tgc_PDOL_0, 
        $Terminal, $Bank, $CA, tgc_encPIN_0, tgc_pubkCard_0>
   ),
   In( acType_339 )
   ]
  -->
   [
   St( ~pid, 'tgk46',
       <<'CDA', u_furtherData_341>, tgc_CVM_0, ~u_tgany11_340, $Terminal, 
        $Bank, $CA, <tgc_PDOL_0, 'TVR', tgc_CVM_0, 'HHMMSS'>, acType_339, 
        tgc_encPIN_0, tgc_pubkCard_0>
   ),
   Out( <'GENERATE_AC', acType_339, 'CDA', 'TVR', tgc_CVM_0, 'HHMMSS'> )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_361_44to45:
   [
   St( ~pid, 'tgk44',
       <tgc_AIP_0, tgc_CVM_0, ~u_tgany7_331, $Terminal, $Bank, $CA, 
        <PDOL_332, CDOL1_335>, tgc_acType_0, tgc_encPIN_0>
   ),
   In( <CID_334, ATC_336, AC_337, IAD_333> ), Fr( ~channelID_330 )
   ]
  --[
  Compatible_CID_acType_246( CID_334, tgc_acType_0 ),
  Compatible_CID_CVM_247( CID_334, tgc_CVM_0 ),
  Running_92( $Terminal, $Bank,
              <'Terminal', 'Bank', ~u_tgany7_331, tgc_AIP_0, tgc_CVM_0, 
               <PDOL_332, CDOL1_335>, ATC_336, AC_337, IAD_333>
  )
  ]->
   [
   Send_32( $Terminal, $Bank, <~channelID_330, 'Mastercard', '1'>,
            <
             <~u_tgany7_331, tgc_AIP_0, tgc_CVM_0, <PDOL_332, CDOL1_335>, ATC_336, 
              AC_337, IAD_333>, 
             tgc_encPIN_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_361_46to47:
   [
   St( ~pid, 'tgk46',
       <tgc_AIP_0, tgc_CVM_0, ~u_tgany9_350, $Terminal, $Bank, $CA, 
        <<$amount, country_348, currency_347, date_346, type_344, ~UN_352>, 
         u_tgany10_351>, 
        tgc_acType_0, tgc_encPIN_0, tgc_pubkCard_0>
   ),
   In( <CID_355, ATC_356, AC_357, <nc_345, SDAD_353>, IAD_354> ),
   Fr( ~channelID_349 )
   ]
  --[
  Compatible_CID_acType_246( CID_355, tgc_acType_0 ),
  Compatible_CID_CVM_247( CID_355, tgc_CVM_0 ),
  Eq_27( verify(SDAD_353,
                <'05', nc_345, CID_355, AC_357, 
                 h(<
                    <<$amount, country_348, currency_347, date_346, type_344, ~UN_352>, 
                     u_tgany10_351>, 
                    CID_355, ATC_356, AC_357, IAD_354>), 
                 ~UN_352>,
                tgc_pubkCard_0),
         true
  ),
  Running_92( $Terminal, $Bank,
              <'Terminal', 'Bank', ~u_tgany9_350, tgc_AIP_0, tgc_CVM_0, 
               <<$amount, country_348, currency_347, date_346, type_344, ~UN_352>, 
                u_tgany10_351>, 
               ATC_356, AC_357, IAD_354>
  )
  ]->
   [
   Send_32( $Terminal, $Bank, <~channelID_349, 'Mastercard', '1'>,
            <
             <~u_tgany9_350, tgc_AIP_0, tgc_CVM_0, 
              <<$amount, country_348, currency_347, date_346, type_344, ~UN_352>, 
               u_tgany10_351>, 
              ATC_356, AC_357, IAD_354>, 
             tgc_encPIN_0>
   )
   ]

  /*
  rule (modulo AC) TgRuleTerminal_361_46to47:
     [
     St( ~pid, 'tgk46',
         <tgc_AIP_0, tgc_CVM_0, ~u_tgany9_350, $Terminal, $Bank, $CA, 
          <<$amount, country_348, currency_347, date_346, type_344, ~UN_352>, 
           u_tgany10_351>, 
          tgc_acType_0, tgc_encPIN_0, tgc_pubkCard_0>
     ),
     In( <CID_355, ATC_356, AC_357, <nc_345, SDAD_353>, IAD_354> ),
     Fr( ~channelID_349 )
     ]
    --[
    Compatible_CID_acType_246( CID_355, tgc_acType_0 ),
    Compatible_CID_CVM_247( CID_355, tgc_CVM_0 ), Eq_27( z, true ),
    Running_92( $Terminal, $Bank,
                <'Terminal', 'Bank', ~u_tgany9_350, tgc_AIP_0, tgc_CVM_0, 
                 <<$amount, country_348, currency_347, date_346, type_344, ~UN_352>, 
                  u_tgany10_351>, 
                 ATC_356, AC_357, IAD_354>
    )
    ]->
     [
     Send_32( $Terminal, $Bank, <~channelID_349, 'Mastercard', '1'>,
              <
               <~u_tgany9_350, tgc_AIP_0, tgc_CVM_0, 
                <<$amount, country_348, currency_347, date_346, type_344, ~UN_352>, 
                 u_tgany10_351>, 
                ATC_356, AC_357, IAD_354>, 
               tgc_encPIN_0>
     )
     ]
    variants (modulo AC)
    1. $amount
             = $amount.50
       ~UN_352
             = ~UN_352.51
       AC_357
             = AC_357.55
       ATC_356
             = ATC_356.56
       CID_355
             = CID_355.57
       IAD_354
             = IAD_354.58
       SDAD_353
             = SDAD_353.59
       country_348
             = country_348.60
       currency_347
             = currency_347.61
       date_346
             = date_346.62
       nc_345
             = nc_345.63
       tgc_pubkCard_0
             = tgc_pubkCard_0.68
       type_344
             = type_344.69
       u_tgany10_351
             = u_tgany10_351.70
       z     = verify(SDAD_353.59,
                      <'05', nc_345.63, CID_355.57, AC_357.55, 
                       h(<
                          <
                           <$amount.50, country_348.60, currency_347.61, date_346.62, type_344.69, 
                            ~UN_352.51>, 
                           u_tgany10_351.70>, 
                          CID_355.57, ATC_356.56, AC_357.55, IAD_354.58>), 
                       ~UN_352.51>,
                      tgc_pubkCard_0.68)
    
    2. $amount
             = $amount.153
       ~UN_352
             = ~UN_352.154
       AC_357
             = AC_357.158
       ATC_356
             = ATC_356.159
       CID_355
             = CID_355.160
       IAD_354
             = IAD_354.161
       SDAD_353
             = sign(<'05', nc_345.166, CID_355.160, AC_357.158, 
                     h(<
                        <
                         <$amount.153, country_348.163, currency_347.164, date_346.165, 
                          type_344.172, ~UN_352.154>, 
                         u_tgany10_351.173>, 
                        CID_355.160, ATC_356.159, AC_357.158, IAD_354.161>), 
                     ~UN_352.154>,
                    x.301)
       country_348
             = country_348.163
       currency_347
             = currency_347.164
       date_346
             = date_346.165
       nc_345
             = nc_345.166
       tgc_pubkCard_0
             = pk(x.301)
       type_344
             = type_344.172
       u_tgany10_351
             = u_tgany10_351.173
       z     = true
  */

rule (modulo E) TgStartTerminal_Visa_461_48:
   [ Fr( ~pid ) ] --> [ St( ~pid, 'tgk48', 'empty_tuple' ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_Visa_461_48to49:
   [
   St( ~pid, 'tgk48', 'empty_tuple' ), Fr( ~UN_362 ),
   !Value_35( $amount, 'Low' )
   ]
  --[ OneTerminal_245( ), Role_48( $Terminal, 'Terminal' ) ]->
   [
   St( ~pid, 'tgk49',
       <
        <<'TC', 'NoPIN'>, $amount, 'Switzerland', 'CHF', 'YYMMDD', 'Purchase', 
         ~UN_362>, 
        $Terminal>
   ),
   Out( <'GET_PROCESSING_OPTIONS', <'TC', 'NoPIN'>, $amount, 'Switzerland', 
         'CHF', 'YYMMDD', 'Purchase', ~UN_362>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_Visa_461_48to50:
   [
   St( ~pid, 'tgk48', 'empty_tuple' ), Fr( ~UN_369 ),
   !Value_35( $amount, 'High' )
   ]
  --[ OneTerminal_245( ), Role_48( $Terminal, 'Terminal' ) ]->
   [
   St( ~pid, 'tgk50',
       <
        <<'ARQC', 'OnlinePIN'>, $amount, 'Switzerland', 'CHF', 'YYMMDD', 
         'Purchase', ~UN_369>, 
        $Terminal>
   ),
   Out( <'GET_PROCESSING_OPTIONS', <'ARQC', 'OnlinePIN'>, $amount, 
         'Switzerland', 'CHF', 'YYMMDD', 'Purchase', ~UN_369>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_Visa_461_49to51:
   [
   St( ~pid, 'tgk49',
       <
        <<acType_381, CVM_385>, $amount, country_380, currency_379, date_378, 
         type_376, ~UN_382>, 
        $Terminal>
   ),
   In( <AIP_389, 'AFL', <~PAN_383, expDate_377>, IAD_384, AC_390, CID_387, 
        ATC_388, CTQ_386>
   )
   ]
  --[ Compatible_CID_acType_246( CID_387, acType_381 ) ]->
   [
   St( ~pid, 'tgk51',
       <AC_390, AIP_389, ATC_388, CID_387, CTQ_386, IAD_384, ~PAN_383, 
        <<acType_381, CVM_385>, $amount, country_380, currency_379, date_378, 
         type_376, ~UN_382>, 
        $Terminal, expDate_377>
   ),
   Out( <'READ_RECORD', 'AFL'> )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_Visa_461_50to51:
   [
   St( ~pid, 'tgk50',
       <
        <<acType_381, CVM_385>, $amount, country_380, currency_379, date_378, 
         type_376, ~UN_382>, 
        $Terminal>
   ),
   In( <AIP_389, 'AFL', <~PAN_383, expDate_377>, IAD_384, AC_390, CID_387, 
        ATC_388, CTQ_386>
   )
   ]
  --[ Compatible_CID_acType_246( CID_387, acType_381 ) ]->
   [
   St( ~pid, 'tgk51',
       <AC_390, AIP_389, ATC_388, CID_387, CTQ_386, IAD_384, ~PAN_383, 
        <<acType_381, CVM_385>, $amount, country_380, currency_379, date_378, 
         type_376, ~UN_382>, 
        $Terminal, expDate_377>
   ),
   Out( <'READ_RECORD', 'AFL'> )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_Visa_461_51to52:
   [
   St( ~pid, 'tgk51',
       <tgc_AC_0, <'EMV', u_tgany21_394>, tgc_ATC_0, 'ARQC', tgc_CTQ_0, 
        tgc_IAD_0, ~u_tgany22_393, tgc_PDOL_0, $Terminal, tgc_expDate_0>
   ),
   In( <~u_tgany22_393, tgc_expDate_0> ),
   !IssuingBank_66( ~u_tgany22_393, $Bank ),
   !CertBank_57( $Bank, <<'02', $Bank, pubkBank_392, $CA>, sign2_391> )
   ]
  -->
   [
   St( ~pid, 'tgk52',
       <tgc_AC_0, <'EMV', u_tgany21_394>, tgc_ATC_0, 'ARQC', tgc_CTQ_0, 
        tgc_IAD_0, ~u_tgany22_393, tgc_PDOL_0, $Terminal, $CA, $Bank, 
        pubkBank_392>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_Visa_461_51to53:
   [
   St( ~pid, 'tgk51',
       <tgc_AC_0, <'DDA', u_tgany23_409>, tgc_ATC_0, tgc_CID_0, tgc_CTQ_0, 
        tgc_IAD_0, ~u_tgany24_408, 
        <TTQ_411, $amount, country_407, currency_406, date_405, type_396, ~UN_410
        >, 
        $Terminal, tgc_expDate_0>
   ),
   In( <~u_tgany24_408, tgc_expDate_0, $CA, 
        <<'02', $Bank, pubkBank_402, $CA>, sign2_398>, 
        <<'04', ~u_tgany24_408, pubkCard_400, $Bank>, sign3_397>, nc_403, 
        CTQ_413, SDAD_412>
   ),
   !IssuingCA_58( $Bank, $CA ), !SDADFormat_37( format_404, tgc_CID_0 ),
   !CertCA_50( $CA, <<'01', $CA, pubkCA_401, $CA>, sign1_399> )
   ]
  --[
  Eq_27( verify(sign1_399, <'01', $CA, pubkCA_401, $CA>, pubkCA_401), true
  ),
  Eq_27( verify(sign2_398, <'02', $Bank, pubkBank_402, $CA>, pubkCA_401),
         true
  ),
  Eq_27( verify(sign3_397, <'04', ~u_tgany24_408, pubkCard_400, $Bank>,
                pubkBank_402),
         true
  ),
  Eq_27( verify(SDAD_412,
                <format_404, nc_403, tgc_CID_0, tgc_AC_0, 
                 <TTQ_411, $amount, country_407, currency_406, date_405, type_396, ~UN_410
                 >, 
                 tgc_ATC_0, tgc_CTQ_0, ~UN_410, tgc_IAD_0, 'DDA', u_tgany23_409>,
                pubkCard_400),
         true
  )
  ]->
   [
   St( ~pid, 'tgk53',
       <tgc_AC_0, <'DDA', u_tgany23_409>, tgc_ATC_0, tgc_CID_0, tgc_CTQ_0, 
        tgc_IAD_0, ~u_tgany24_408, 
        <TTQ_411, $amount, country_407, currency_406, date_405, type_396, ~UN_410
        >, 
        $Terminal, $CA, $Bank, pubkBank_402>
   )
   ]

  /*
  rule (modulo AC) TgRuleTerminal_Visa_461_51to53:
     [
     St( ~pid, 'tgk51',
         <tgc_AC_0, <'DDA', u_tgany23_409>, tgc_ATC_0, tgc_CID_0, tgc_CTQ_0, 
          tgc_IAD_0, ~u_tgany24_408, 
          <TTQ_411, $amount, country_407, currency_406, date_405, type_396, ~UN_410
          >, 
          $Terminal, tgc_expDate_0>
     ),
     In( <~u_tgany24_408, tgc_expDate_0, $CA, 
          <<'02', $Bank, pubkBank_402, $CA>, sign2_398>, 
          <<'04', ~u_tgany24_408, pubkCard_400, $Bank>, sign3_397>, nc_403, 
          CTQ_413, SDAD_412>
     ),
     !IssuingCA_58( $Bank, $CA ), !SDADFormat_37( format_404, tgc_CID_0 ),
     !CertCA_50( $CA, <<'01', $CA, pubkCA_401, $CA>, sign1_399> )
     ]
    --[
    Eq_27( z, true ), Eq_27( z.1, true ), Eq_27( z.2, true ),
    Eq_27( z.3, true )
    ]->
     [
     St( ~pid, 'tgk53',
         <tgc_AC_0, <'DDA', u_tgany23_409>, tgc_ATC_0, tgc_CID_0, tgc_CTQ_0, 
          tgc_IAD_0, ~u_tgany24_408, 
          <TTQ_411, $amount, country_407, currency_406, date_405, type_396, ~UN_410
          >, 
          $Terminal, $CA, $Bank, pubkBank_402>
     )
     ]
    variants (modulo AC)
     1. $Bank = $Bank.69
        $CA   = $CA.70
        $amount
              = $amount.72
        ~UN_410
              = ~UN_410.73
        ~u_tgany24_408
              = ~u_tgany24_408.75
        SDAD_412
              = SDAD_412.77
        TTQ_411
              = TTQ_411.78
        country_407
              = country_407.79
        currency_406
              = currency_406.80
        date_405
              = date_405.81
        format_404
              = format_404.82
        nc_403
              = nc_403.83
        pubkBank_402
              = pubkBank_402.84
        pubkCA_401
              = pubkCA_401.85
        pubkCard_400
              = pubkCard_400.86
        sign1_399
              = sign1_399.87
        sign2_398
              = sign2_398.88
        sign3_397
              = sign3_397.89
        tgc_AC_0
              = tgc_AC_0.90
        tgc_ATC_0
              = tgc_ATC_0.91
        tgc_CID_0
              = tgc_CID_0.92
        tgc_CTQ_0
              = tgc_CTQ_0.93
        tgc_IAD_0
              = tgc_IAD_0.94
        type_396
              = type_396.96
        u_tgany23_409
              = u_tgany23_409.97
        z     = verify(sign1_399.87, <'01', $CA.70, pubkCA_401.85, $CA.70>,
                       pubkCA_401.85)
        z.1   = verify(sign2_398.88, <'02', $Bank.69, pubkBank_402.84, $CA.70>,
                       pubkCA_401.85)
        z.2   = verify(sign3_397.89,
                       <'04', ~u_tgany24_408.75, pubkCard_400.86, $Bank.69>, pubkBank_402.84)
        z.3   = verify(SDAD_412.77,
                       <format_404.82, nc_403.83, tgc_CID_0.92, tgc_AC_0.90, 
                        <TTQ_411.78, $amount.72, country_407.79, currency_406.80, date_405.81, 
                         type_396.96, ~UN_410.73>, 
                        tgc_ATC_0.91, tgc_CTQ_0.93, ~UN_410.73, tgc_IAD_0.94, 'DDA', 
                        u_tgany23_409.97>,
                       pubkCard_400.86)
    
     2. $Bank = $Bank.251
        $CA   = $CA.252
        $amount
              = $amount.254
        ~UN_410
              = ~UN_410.255
        ~u_tgany24_408
              = ~u_tgany24_408.257
        SDAD_412
              = SDAD_412.259
        TTQ_411
              = TTQ_411.260
        country_407
              = country_407.261
        currency_406
              = currency_406.262
        date_405
              = date_405.263
        format_404
              = format_404.264
        nc_403
              = nc_403.265
        pubkBank_402
              = pubkBank_402.266
        pubkCA_401
              = pk(x.500)
        pubkCard_400
              = pubkCard_400.268
        sign1_399
              = sign(<'01', $CA.252, pk(x.500), $CA.252>, x.500)
        sign2_398
              = sign2_398.270
        sign3_397
              = sign3_397.271
        tgc_AC_0
              = tgc_AC_0.272
        tgc_ATC_0
              = tgc_ATC_0.273
        tgc_CID_0
              = tgc_CID_0.274
        tgc_CTQ_0
              = tgc_CTQ_0.275
        tgc_IAD_0
              = tgc_IAD_0.276
        type_396
              = type_396.278
        u_tgany23_409
              = u_tgany23_409.279
        z     = true
        z.1   = verify(sign2_398.270,
                       <'02', $Bank.251, pubkBank_402.266, $CA.252>, pk(x.500))
        z.2   = verify(sign3_397.271,
                       <'04', ~u_tgany24_408.257, pubkCard_400.268, $Bank.251>,
                       pubkBank_402.266)
        z.3   = verify(SDAD_412.259,
                       <format_404.264, nc_403.265, tgc_CID_0.274, tgc_AC_0.272, 
                        <TTQ_411.260, $amount.254, country_407.261, currency_406.262, 
                         date_405.263, type_396.278, ~UN_410.255>, 
                        tgc_ATC_0.273, tgc_CTQ_0.275, ~UN_410.255, tgc_IAD_0.276, 'DDA', 
                        u_tgany23_409.279>,
                       pubkCard_400.268)
    
     3. $Bank = $Bank.251
        $CA   = $CA.252
        $amount
              = $amount.254
        ~UN_410
              = ~UN_410.255
        ~u_tgany24_408
              = ~u_tgany24_408.257
        SDAD_412
              = SDAD_412.259
        TTQ_411
              = TTQ_411.260
        country_407
              = country_407.261
        currency_406
              = currency_406.262
        date_405
              = date_405.263
        format_404
              = format_404.264
        nc_403
              = nc_403.265
        pubkBank_402
              = pk(x.500)
        pubkCA_401
              = pubkCA_401.267
        pubkCard_400
              = pubkCard_400.268
        sign1_399
              = sign1_399.269
        sign2_398
              = sign2_398.270
        sign3_397
              = sign(<'04', ~u_tgany24_408.257, pubkCard_400.268, $Bank.251>, x.500)
        tgc_AC_0
              = tgc_AC_0.272
        tgc_ATC_0
              = tgc_ATC_0.273
        tgc_CID_0
              = tgc_CID_0.274
        tgc_CTQ_0
              = tgc_CTQ_0.275
        tgc_IAD_0
              = tgc_IAD_0.276
        type_396
              = type_396.278
        u_tgany23_409
              = u_tgany23_409.279
        z     = verify(sign1_399.269, <'01', $CA.252, pubkCA_401.267, $CA.252>,
                       pubkCA_401.267)
        z.1   = verify(sign2_398.270, <'02', $Bank.251, pk(x.500), $CA.252>,
                       pubkCA_401.267)
        z.2   = true
        z.3   = verify(SDAD_412.259,
                       <format_404.264, nc_403.265, tgc_CID_0.274, tgc_AC_0.272, 
                        <TTQ_411.260, $amount.254, country_407.261, currency_406.262, 
                         date_405.263, type_396.278, ~UN_410.255>, 
                        tgc_ATC_0.273, tgc_CTQ_0.275, ~UN_410.255, tgc_IAD_0.276, 'DDA', 
                        u_tgany23_409.279>,
                       pubkCard_400.268)
    
     4. $Bank = $Bank.252
        $CA   = $CA.253
        $amount
              = $amount.255
        ~UN_410
              = ~UN_410.256
        ~u_tgany24_408
              = ~u_tgany24_408.258
        SDAD_412
              = SDAD_412.260
        TTQ_411
              = TTQ_411.261
        country_407
              = country_407.262
        currency_406
              = currency_406.263
        date_405
              = date_405.264
        format_404
              = format_404.265
        nc_403
              = nc_403.266
        pubkBank_402
              = pubkBank_402.267
        pubkCA_401
              = pk(x.502)
        pubkCard_400
              = pubkCard_400.269
        sign1_399
              = sign1_399.270
        sign2_398
              = sign(<'02', $Bank.252, pubkBank_402.267, $CA.253>, x.502)
        sign3_397
              = sign3_397.272
        tgc_AC_0
              = tgc_AC_0.273
        tgc_ATC_0
              = tgc_ATC_0.274
        tgc_CID_0
              = tgc_CID_0.275
        tgc_CTQ_0
              = tgc_CTQ_0.276
        tgc_IAD_0
              = tgc_IAD_0.277
        type_396
              = type_396.279
        u_tgany23_409
              = u_tgany23_409.280
        z     = verify(sign1_399.270, <'01', $CA.253, pk(x.502), $CA.253>,
                       pk(x.502))
        z.1   = true
        z.2   = verify(sign3_397.272,
                       <'04', ~u_tgany24_408.258, pubkCard_400.269, $Bank.252>,
                       pubkBank_402.267)
        z.3   = verify(SDAD_412.260,
                       <format_404.265, nc_403.266, tgc_CID_0.275, tgc_AC_0.273, 
                        <TTQ_411.261, $amount.255, country_407.262, currency_406.263, 
                         date_405.264, type_396.279, ~UN_410.256>, 
                        tgc_ATC_0.274, tgc_CTQ_0.276, ~UN_410.256, tgc_IAD_0.277, 'DDA', 
                        u_tgany23_409.280>,
                       pubkCard_400.269)
    
     5. $Bank = $Bank.252
        $CA   = $CA.253
        $amount
              = $amount.255
        ~UN_410
              = ~UN_410.256
        ~u_tgany24_408
              = ~u_tgany24_408.258
        SDAD_412
              = SDAD_412.260
        TTQ_411
              = TTQ_411.261
        country_407
              = country_407.262
        currency_406
              = currency_406.263
        date_405
              = date_405.264
        format_404
              = format_404.265
        nc_403
              = nc_403.266
        pubkBank_402
              = pubkBank_402.267
        pubkCA_401
              = pk(x.502)
        pubkCard_400
              = pubkCard_400.269
        sign1_399
              = sign(<'01', $CA.253, pk(x.502), $CA.253>, x.502)
        sign2_398
              = sign(<'02', $Bank.252, pubkBank_402.267, $CA.253>, x.502)
        sign3_397
              = sign3_397.272
        tgc_AC_0
              = tgc_AC_0.273
        tgc_ATC_0
              = tgc_ATC_0.274
        tgc_CID_0
              = tgc_CID_0.275
        tgc_CTQ_0
              = tgc_CTQ_0.276
        tgc_IAD_0
              = tgc_IAD_0.277
        type_396
              = type_396.279
        u_tgany23_409
              = u_tgany23_409.280
        z     = true
        z.1   = true
        z.2   = verify(sign3_397.272,
                       <'04', ~u_tgany24_408.258, pubkCard_400.269, $Bank.252>,
                       pubkBank_402.267)
        z.3   = verify(SDAD_412.260,
                       <format_404.265, nc_403.266, tgc_CID_0.275, tgc_AC_0.273, 
                        <TTQ_411.261, $amount.255, country_407.262, currency_406.263, 
                         date_405.264, type_396.279, ~UN_410.256>, 
                        tgc_ATC_0.274, tgc_CTQ_0.276, ~UN_410.256, tgc_IAD_0.277, 'DDA', 
                        u_tgany23_409.280>,
                       pubkCard_400.269)
    
     6. $Bank = $Bank.252
        $CA   = $CA.253
        $amount
              = $amount.255
        ~UN_410
              = ~UN_410.256
        ~u_tgany24_408
              = ~u_tgany24_408.258
        SDAD_412
              = SDAD_412.260
        TTQ_411
              = TTQ_411.261
        country_407
              = country_407.262
        currency_406
              = currency_406.263
        date_405
              = date_405.264
        format_404
              = format_404.265
        nc_403
              = nc_403.266
        pubkBank_402
              = pk(x.501)
        pubkCA_401
              = pk(x.502)
        pubkCard_400
              = pubkCard_400.269
        sign1_399
              = sign1_399.270
        sign2_398
              = sign(<'02', $Bank.252, pk(x.501), $CA.253>, x.502)
        sign3_397
              = sign(<'04', ~u_tgany24_408.258, pubkCard_400.269, $Bank.252>, x.501)
        tgc_AC_0
              = tgc_AC_0.273
        tgc_ATC_0
              = tgc_ATC_0.274
        tgc_CID_0
              = tgc_CID_0.275
        tgc_CTQ_0
              = tgc_CTQ_0.276
        tgc_IAD_0
              = tgc_IAD_0.277
        type_396
              = type_396.279
        u_tgany23_409
              = u_tgany23_409.280
        z     = verify(sign1_399.270, <'01', $CA.253, pk(x.502), $CA.253>,
                       pk(x.502))
        z.1   = true
        z.2   = true
        z.3   = verify(SDAD_412.260,
                       <format_404.265, nc_403.266, tgc_CID_0.275, tgc_AC_0.273, 
                        <TTQ_411.261, $amount.255, country_407.262, currency_406.263, 
                         date_405.264, type_396.279, ~UN_410.256>, 
                        tgc_ATC_0.274, tgc_CTQ_0.276, ~UN_410.256, tgc_IAD_0.277, 'DDA', 
                        u_tgany23_409.280>,
                       pubkCard_400.269)
    
     7. $Bank = $Bank.252
        $CA   = $CA.253
        $amount
              = $amount.255
        ~UN_410
              = ~UN_410.256
        ~u_tgany24_408
              = ~u_tgany24_408.258
        SDAD_412
              = SDAD_412.260
        TTQ_411
              = TTQ_411.261
        country_407
              = country_407.262
        currency_406
              = currency_406.263
        date_405
              = date_405.264
        format_404
              = format_404.265
        nc_403
              = nc_403.266
        pubkBank_402
              = pk(x.501)
        pubkCA_401
              = pk(x.502)
        pubkCard_400
              = pubkCard_400.269
        sign1_399
              = sign(<'01', $CA.253, pk(x.502), $CA.253>, x.502)
        sign2_398
              = sign2_398.271
        sign3_397
              = sign(<'04', ~u_tgany24_408.258, pubkCard_400.269, $Bank.252>, x.501)
        tgc_AC_0
              = tgc_AC_0.273
        tgc_ATC_0
              = tgc_ATC_0.274
        tgc_CID_0
              = tgc_CID_0.275
        tgc_CTQ_0
              = tgc_CTQ_0.276
        tgc_IAD_0
              = tgc_IAD_0.277
        type_396
              = type_396.279
        u_tgany23_409
              = u_tgany23_409.280
        z     = true
        z.1   = verify(sign2_398.271, <'02', $Bank.252, pk(x.501), $CA.253>,
                       pk(x.502))
        z.2   = true
        z.3   = verify(SDAD_412.260,
                       <format_404.265, nc_403.266, tgc_CID_0.275, tgc_AC_0.273, 
                        <TTQ_411.261, $amount.255, country_407.262, currency_406.263, 
                         date_405.264, type_396.279, ~UN_410.256>, 
                        tgc_ATC_0.274, tgc_CTQ_0.276, ~UN_410.256, tgc_IAD_0.277, 'DDA', 
                        u_tgany23_409.280>,
                       pubkCard_400.269)
    
     8. $Bank = $Bank.252
        $CA   = $CA.253
        $amount
              = $amount.255
        ~UN_410
              = ~UN_410.256
        ~u_tgany24_408
              = ~u_tgany24_408.258
        SDAD_412
              = SDAD_412.260
        TTQ_411
              = TTQ_411.261
        country_407
              = country_407.262
        currency_406
              = currency_406.263
        date_405
              = date_405.264
        format_404
              = format_404.265
        nc_403
              = nc_403.266
        pubkBank_402
              = pk(x.501)
        pubkCA_401
              = pk(x.502)
        pubkCard_400
              = pubkCard_400.269
        sign1_399
              = sign(<'01', $CA.253, pk(x.502), $CA.253>, x.502)
        sign2_398
              = sign(<'02', $Bank.252, pk(x.501), $CA.253>, x.502)
        sign3_397
              = sign(<'04', ~u_tgany24_408.258, pubkCard_400.269, $Bank.252>, x.501)
        tgc_AC_0
              = tgc_AC_0.273
        tgc_ATC_0
              = tgc_ATC_0.274
        tgc_CID_0
              = tgc_CID_0.275
        tgc_CTQ_0
              = tgc_CTQ_0.276
        tgc_IAD_0
              = tgc_IAD_0.277
        type_396
              = type_396.279
        u_tgany23_409
              = u_tgany23_409.280
        z     = true
        z.1   = true
        z.2   = true
        z.3   = verify(SDAD_412.260,
                       <format_404.265, nc_403.266, tgc_CID_0.275, tgc_AC_0.273, 
                        <TTQ_411.261, $amount.255, country_407.262, currency_406.263, 
                         date_405.264, type_396.279, ~UN_410.256>, 
                        tgc_ATC_0.274, tgc_CTQ_0.276, ~UN_410.256, tgc_IAD_0.277, 'DDA', 
                        u_tgany23_409.280>,
                       pubkCard_400.269)
    
     9. $Bank = $Bank.254
        $CA   = $CA.255
        $amount
              = $amount.257
        ~UN_410
              = ~UN_410.258
        ~u_tgany24_408
              = ~u_tgany24_408.260
        SDAD_412
              = sign(<format_404.267, nc_403.268, tgc_CID_0.277, tgc_AC_0.275, 
                      <TTQ_411.263, $amount.257, country_407.264, currency_406.265, 
                       date_405.266, type_396.281, ~UN_410.258>, 
                      tgc_ATC_0.276, tgc_CTQ_0.278, ~UN_410.258, tgc_IAD_0.279, 'DDA', 
                      u_tgany23_409.282>,
                     x.506)
        TTQ_411
              = TTQ_411.263
        country_407
              = country_407.264
        currency_406
              = currency_406.265
        date_405
              = date_405.266
        format_404
              = format_404.267
        nc_403
              = nc_403.268
        pubkBank_402
              = pubkBank_402.269
        pubkCA_401
              = pubkCA_401.270
        pubkCard_400
              = pk(x.506)
        sign1_399
              = sign1_399.272
        sign2_398
              = sign2_398.273
        sign3_397
              = sign3_397.274
        tgc_AC_0
              = tgc_AC_0.275
        tgc_ATC_0
              = tgc_ATC_0.276
        tgc_CID_0
              = tgc_CID_0.277
        tgc_CTQ_0
              = tgc_CTQ_0.278
        tgc_IAD_0
              = tgc_IAD_0.279
        type_396
              = type_396.281
        u_tgany23_409
              = u_tgany23_409.282
        z     = verify(sign1_399.272, <'01', $CA.255, pubkCA_401.270, $CA.255>,
                       pubkCA_401.270)
        z.1   = verify(sign2_398.273,
                       <'02', $Bank.254, pubkBank_402.269, $CA.255>, pubkCA_401.270)
        z.2   = verify(sign3_397.274,
                       <'04', ~u_tgany24_408.260, pk(x.506), $Bank.254>, pubkBank_402.269)
        z.3   = true
    
    10. $Bank = $Bank.258
        $CA   = $CA.259
        $amount
              = $amount.261
        ~UN_410
              = ~UN_410.262
        ~u_tgany24_408
              = ~u_tgany24_408.264
        SDAD_412
              = sign(<format_404.271, nc_403.272, tgc_CID_0.281, tgc_AC_0.279, 
                      <TTQ_411.267, $amount.261, country_407.268, currency_406.269, 
                       date_405.270, type_396.285, ~UN_410.262>, 
                      tgc_ATC_0.280, tgc_CTQ_0.282, ~UN_410.262, tgc_IAD_0.283, 'DDA', 
                      u_tgany23_409.286>,
                     x.512)
        TTQ_411
              = TTQ_411.267
        country_407
              = country_407.268
        currency_406
              = currency_406.269
        date_405
              = date_405.270
        format_404
              = format_404.271
        nc_403
              = nc_403.272
        pubkBank_402
              = pubkBank_402.273
        pubkCA_401
              = pk(x.514)
        pubkCard_400
              = pk(x.512)
        sign1_399
              = sign(<'01', $CA.259, pk(x.514), $CA.259>, x.514)
        sign2_398
              = sign2_398.277
        sign3_397
              = sign3_397.278
        tgc_AC_0
              = tgc_AC_0.279
        tgc_ATC_0
              = tgc_ATC_0.280
        tgc_CID_0
              = tgc_CID_0.281
        tgc_CTQ_0
              = tgc_CTQ_0.282
        tgc_IAD_0
              = tgc_IAD_0.283
        type_396
              = type_396.285
        u_tgany23_409
              = u_tgany23_409.286
        z     = true
        z.1   = verify(sign2_398.277,
                       <'02', $Bank.258, pubkBank_402.273, $CA.259>, pk(x.514))
        z.2   = verify(sign3_397.278,
                       <'04', ~u_tgany24_408.264, pk(x.512), $Bank.258>, pubkBank_402.273)
        z.3   = true
    
    11. $Bank = $Bank.258
        $CA   = $CA.259
        $amount
              = $amount.261
        ~UN_410
              = ~UN_410.262
        ~u_tgany24_408
              = ~u_tgany24_408.264
        SDAD_412
              = sign(<format_404.271, nc_403.272, tgc_CID_0.281, tgc_AC_0.279, 
                      <TTQ_411.267, $amount.261, country_407.268, currency_406.269, 
                       date_405.270, type_396.285, ~UN_410.262>, 
                      tgc_ATC_0.280, tgc_CTQ_0.282, ~UN_410.262, tgc_IAD_0.283, 'DDA', 
                      u_tgany23_409.286>,
                     x.513)
        TTQ_411
              = TTQ_411.267
        country_407
              = country_407.268
        currency_406
              = currency_406.269
        date_405
              = date_405.270
        format_404
              = format_404.271
        nc_403
              = nc_403.272
        pubkBank_402
              = pk(x.514)
        pubkCA_401
              = pubkCA_401.274
        pubkCard_400
              = pk(x.513)
        sign1_399
              = sign1_399.276
        sign2_398
              = sign2_398.277
        sign3_397
              = sign(<'04', ~u_tgany24_408.264, pk(x.513), $Bank.258>, x.514)
        tgc_AC_0
              = tgc_AC_0.279
        tgc_ATC_0
              = tgc_ATC_0.280
        tgc_CID_0
              = tgc_CID_0.281
        tgc_CTQ_0
              = tgc_CTQ_0.282
        tgc_IAD_0
              = tgc_IAD_0.283
        type_396
              = type_396.285
        u_tgany23_409
              = u_tgany23_409.286
        z     = verify(sign1_399.276, <'01', $CA.259, pubkCA_401.274, $CA.259>,
                       pubkCA_401.274)
        z.1   = verify(sign2_398.277, <'02', $Bank.258, pk(x.514), $CA.259>,
                       pubkCA_401.274)
        z.2   = true
        z.3   = true
    
    12. $Bank = $Bank.259
        $CA   = $CA.260
        $amount
              = $amount.262
        ~UN_410
              = ~UN_410.263
        ~u_tgany24_408
              = ~u_tgany24_408.265
        SDAD_412
              = sign(<format_404.272, nc_403.273, tgc_CID_0.282, tgc_AC_0.280, 
                      <TTQ_411.268, $amount.262, country_407.269, currency_406.270, 
                       date_405.271, type_396.286, ~UN_410.263>, 
                      tgc_ATC_0.281, tgc_CTQ_0.283, ~UN_410.263, tgc_IAD_0.284, 'DDA', 
                      u_tgany23_409.287>,
                     x.514)
        TTQ_411
              = TTQ_411.268
        country_407
              = country_407.269
        currency_406
              = currency_406.270
        date_405
              = date_405.271
        format_404
              = format_404.272
        nc_403
              = nc_403.273
        pubkBank_402
              = pubkBank_402.274
        pubkCA_401
              = pk(x.516)
        pubkCard_400
              = pk(x.514)
        sign1_399
              = sign1_399.277
        sign2_398
              = sign(<'02', $Bank.259, pubkBank_402.274, $CA.260>, x.516)
        sign3_397
              = sign3_397.279
        tgc_AC_0
              = tgc_AC_0.280
        tgc_ATC_0
              = tgc_ATC_0.281
        tgc_CID_0
              = tgc_CID_0.282
        tgc_CTQ_0
              = tgc_CTQ_0.283
        tgc_IAD_0
              = tgc_IAD_0.284
        type_396
              = type_396.286
        u_tgany23_409
              = u_tgany23_409.287
        z     = verify(sign1_399.277, <'01', $CA.260, pk(x.516), $CA.260>,
                       pk(x.516))
        z.1   = true
        z.2   = verify(sign3_397.279,
                       <'04', ~u_tgany24_408.265, pk(x.514), $Bank.259>, pubkBank_402.274)
        z.3   = true
    
    13. $Bank = $Bank.259
        $CA   = $CA.260
        $amount
              = $amount.262
        ~UN_410
              = ~UN_410.263
        ~u_tgany24_408
              = ~u_tgany24_408.265
        SDAD_412
              = sign(<format_404.272, nc_403.273, tgc_CID_0.282, tgc_AC_0.280, 
                      <TTQ_411.268, $amount.262, country_407.269, currency_406.270, 
                       date_405.271, type_396.286, ~UN_410.263>, 
                      tgc_ATC_0.281, tgc_CTQ_0.283, ~UN_410.263, tgc_IAD_0.284, 'DDA', 
                      u_tgany23_409.287>,
                     x.514)
        TTQ_411
              = TTQ_411.268
        country_407
              = country_407.269
        currency_406
              = currency_406.270
        date_405
              = date_405.271
        format_404
              = format_404.272
        nc_403
              = nc_403.273
        pubkBank_402
              = pubkBank_402.274
        pubkCA_401
              = pk(x.516)
        pubkCard_400
              = pk(x.514)
        sign1_399
              = sign(<'01', $CA.260, pk(x.516), $CA.260>, x.516)
        sign2_398
              = sign(<'02', $Bank.259, pubkBank_402.274, $CA.260>, x.516)
        sign3_397
              = sign3_397.279
        tgc_AC_0
              = tgc_AC_0.280
        tgc_ATC_0
              = tgc_ATC_0.281
        tgc_CID_0
              = tgc_CID_0.282
        tgc_CTQ_0
              = tgc_CTQ_0.283
        tgc_IAD_0
              = tgc_IAD_0.284
        type_396
              = type_396.286
        u_tgany23_409
              = u_tgany23_409.287
        z     = true
        z.1   = true
        z.2   = verify(sign3_397.279,
                       <'04', ~u_tgany24_408.265, pk(x.514), $Bank.259>, pubkBank_402.274)
        z.3   = true
    
    14. $Bank = $Bank.259
        $CA   = $CA.260
        $amount
              = $amount.262
        ~UN_410
              = ~UN_410.263
        ~u_tgany24_408
              = ~u_tgany24_408.265
        SDAD_412
              = sign(<format_404.272, nc_403.273, tgc_CID_0.282, tgc_AC_0.280, 
                      <TTQ_411.268, $amount.262, country_407.269, currency_406.270, 
                       date_405.271, type_396.286, ~UN_410.263>, 
                      tgc_ATC_0.281, tgc_CTQ_0.283, ~UN_410.263, tgc_IAD_0.284, 'DDA', 
                      u_tgany23_409.287>,
                     x.514)
        TTQ_411
              = TTQ_411.268
        country_407
              = country_407.269
        currency_406
              = currency_406.270
        date_405
              = date_405.271
        format_404
              = format_404.272
        nc_403
              = nc_403.273
        pubkBank_402
              = pk(x.515)
        pubkCA_401
              = pk(x.516)
        pubkCard_400
              = pk(x.514)
        sign1_399
              = sign1_399.277
        sign2_398
              = sign(<'02', $Bank.259, pk(x.515), $CA.260>, x.516)
        sign3_397
              = sign(<'04', ~u_tgany24_408.265, pk(x.514), $Bank.259>, x.515)
        tgc_AC_0
              = tgc_AC_0.280
        tgc_ATC_0
              = tgc_ATC_0.281
        tgc_CID_0
              = tgc_CID_0.282
        tgc_CTQ_0
              = tgc_CTQ_0.283
        tgc_IAD_0
              = tgc_IAD_0.284
        type_396
              = type_396.286
        u_tgany23_409
              = u_tgany23_409.287
        z     = verify(sign1_399.277, <'01', $CA.260, pk(x.516), $CA.260>,
                       pk(x.516))
        z.1   = true
        z.2   = true
        z.3   = true
    
    15. $Bank = $Bank.259
        $CA   = $CA.260
        $amount
              = $amount.262
        ~UN_410
              = ~UN_410.263
        ~u_tgany24_408
              = ~u_tgany24_408.265
        SDAD_412
              = sign(<format_404.272, nc_403.273, tgc_CID_0.282, tgc_AC_0.280, 
                      <TTQ_411.268, $amount.262, country_407.269, currency_406.270, 
                       date_405.271, type_396.286, ~UN_410.263>, 
                      tgc_ATC_0.281, tgc_CTQ_0.283, ~UN_410.263, tgc_IAD_0.284, 'DDA', 
                      u_tgany23_409.287>,
                     x.514)
        TTQ_411
              = TTQ_411.268
        country_407
              = country_407.269
        currency_406
              = currency_406.270
        date_405
              = date_405.271
        format_404
              = format_404.272
        nc_403
              = nc_403.273
        pubkBank_402
              = pk(x.515)
        pubkCA_401
              = pk(x.516)
        pubkCard_400
              = pk(x.514)
        sign1_399
              = sign(<'01', $CA.260, pk(x.516), $CA.260>, x.516)
        sign2_398
              = sign2_398.278
        sign3_397
              = sign(<'04', ~u_tgany24_408.265, pk(x.514), $Bank.259>, x.515)
        tgc_AC_0
              = tgc_AC_0.280
        tgc_ATC_0
              = tgc_ATC_0.281
        tgc_CID_0
              = tgc_CID_0.282
        tgc_CTQ_0
              = tgc_CTQ_0.283
        tgc_IAD_0
              = tgc_IAD_0.284
        type_396
              = type_396.286
        u_tgany23_409
              = u_tgany23_409.287
        z     = true
        z.1   = verify(sign2_398.278, <'02', $Bank.259, pk(x.515), $CA.260>,
                       pk(x.516))
        z.2   = true
        z.3   = true
    
    16. $Bank = $Bank.259
        $CA   = $CA.260
        $amount
              = $amount.262
        ~UN_410
              = ~UN_410.263
        ~u_tgany24_408
              = ~u_tgany24_408.265
        SDAD_412
              = sign(<format_404.272, nc_403.273, tgc_CID_0.282, tgc_AC_0.280, 
                      <TTQ_411.268, $amount.262, country_407.269, currency_406.270, 
                       date_405.271, type_396.286, ~UN_410.263>, 
                      tgc_ATC_0.281, tgc_CTQ_0.283, ~UN_410.263, tgc_IAD_0.284, 'DDA', 
                      u_tgany23_409.287>,
                     x.514)
        TTQ_411
              = TTQ_411.268
        country_407
              = country_407.269
        currency_406
              = currency_406.270
        date_405
              = date_405.271
        format_404
              = format_404.272
        nc_403
              = nc_403.273
        pubkBank_402
              = pk(x.515)
        pubkCA_401
              = pk(x.516)
        pubkCard_400
              = pk(x.514)
        sign1_399
              = sign(<'01', $CA.260, pk(x.516), $CA.260>, x.516)
        sign2_398
              = sign(<'02', $Bank.259, pk(x.515), $CA.260>, x.516)
        sign3_397
              = sign(<'04', ~u_tgany24_408.265, pk(x.514), $Bank.259>, x.515)
        tgc_AC_0
              = tgc_AC_0.280
        tgc_ATC_0
              = tgc_ATC_0.281
        tgc_CID_0
              = tgc_CID_0.282
        tgc_CTQ_0
              = tgc_CTQ_0.283
        tgc_IAD_0
              = tgc_IAD_0.284
        type_396
              = type_396.286
        u_tgany23_409
              = u_tgany23_409.287
        z     = true
        z.1   = true
        z.2   = true
        z.3   = true
  */

rule (modulo E) TgRuleTerminal_Visa_461_52to54:
   [
   St( ~pid, 'tgk52',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, tgc_CID_0, tgc_CTQ_0, tgc_IAD_0, 
        tgc_PAN_0, tgc_PDOL_0, tgc_Role0_0, tgc_Role1_0, tgc_Role2_0, 
        tgc_pubkBank_0>
   )
   ]
  -->
   [
   St( ~pid, 'tgk54',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, tgc_CID_0, tgc_CTQ_0, tgc_IAD_0, 
        tgc_PAN_0, tgc_PDOL_0, tgc_Role0_0, tgc_Role1_0, tgc_Role2_0, 
        tgc_pubkBank_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_Visa_461_53to54:
   [
   St( ~pid, 'tgk53',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, tgc_CID_0, tgc_CTQ_0, tgc_IAD_0, 
        tgc_PAN_0, tgc_PDOL_0, tgc_Role0_0, tgc_Role1_0, tgc_Role2_0, 
        tgc_pubkBank_0>
   )
   ]
  -->
   [
   St( ~pid, 'tgk54',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, tgc_CID_0, tgc_CTQ_0, tgc_IAD_0, 
        tgc_PAN_0, tgc_PDOL_0, tgc_Role0_0, tgc_Role1_0, tgc_Role2_0, 
        tgc_pubkBank_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_Visa_461_54to55:
   [
   St( ~pid, 'tgk54',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, tgc_CID_0, 'NoPIN', tgc_IAD_0, 
        ~u_tgany19_420, 
        <TTQ_422, $amount, country_419, currency_418, date_417, type_416, ~UN_421
        >, 
        $Terminal, $CA, $Bank, tgc_pubkBank_0>
   ),
   !Value_35( $amount, 'Low' )
   ]
  -->
   [
   St( ~pid, 'tgk55',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, tgc_CID_0, 'NoPIN', tgc_IAD_0, 
        ~u_tgany19_420, 
        <TTQ_422, $amount, country_419, currency_418, date_417, type_416, ~UN_421
        >, 
        $Terminal, $CA, $Bank, 'Null'>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_Visa_461_54to56:
   [
   St( ~pid, 'tgk54',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, 'ARQC', 'CDCVM', tgc_IAD_0, tgc_PAN_0, 
        tgc_PDOL_0, $Terminal, $CA, $Bank, tgc_pubkBank_0>
   )
   ]
  -->
   [
   St( ~pid, 'tgk56',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, 'ARQC', 'CDCVM', tgc_IAD_0, tgc_PAN_0, 
        tgc_PDOL_0, $Terminal, $CA, $Bank, 'Null'>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_Visa_461_54to57:
   [
   St( ~pid, 'tgk54',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, 'ARQC', 'OnlinePIN', tgc_IAD_0, 
        ~u_tgany20_427, 
        <TTQ_429, $amount, country_426, currency_425, date_424, type_423, ~UN_428
        >, 
        $Terminal, $CA, $Bank, tgc_pubkBank_0>
   ),
   !Entered_PIN_84( ~u_tgany20_427, PIN_430 ), !Value_35( $amount, 'High' )
   ]
  -->
   [
   St( ~pid, 'tgk57',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, 'ARQC', 'OnlinePIN', tgc_IAD_0, 
        ~u_tgany20_427, 
        <TTQ_429, $amount, country_426, currency_425, date_424, type_423, ~UN_428
        >, 
        $Terminal, $CA, $Bank, aenc(PIN_430, tgc_pubkBank_0)>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_Visa_461_55to58:
   [
   St( ~pid, 'tgk55',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, tgc_CID_0, tgc_CVM_0, tgc_IAD_0, 
        ~u_tgany18_432, tgc_PDOL_0, $Terminal, $CA, $Bank, tgc_encPIN_0>
   ),
   Fr( ~channelID_431 )
   ]
  --[
  Running_92( $Terminal, $Bank,
              <'Terminal', 'Bank', ~u_tgany18_432, tgc_AIP_0, tgc_CVM_0, tgc_PDOL_0, 
               tgc_ATC_0, tgc_AC_0, tgc_IAD_0>
  )
  ]->
   [
   St( ~pid, 'tgk58',
       <tgc_CID_0, ~u_tgany18_432, $Terminal, $Bank, $CA, ~channelID_431, 
        ~u_tgany18_432, tgc_AIP_0, tgc_CVM_0, tgc_PDOL_0, tgc_ATC_0, tgc_AC_0, 
        tgc_IAD_0>
   ),
   Send_32( $Terminal, $Bank, <~channelID_431, 'Visa', '1'>,
            <
             <~u_tgany18_432, tgc_AIP_0, tgc_CVM_0, tgc_PDOL_0, tgc_ATC_0, tgc_AC_0, 
              tgc_IAD_0>, 
             tgc_encPIN_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_Visa_461_56to58:
   [
   St( ~pid, 'tgk56',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, tgc_CID_0, tgc_CVM_0, tgc_IAD_0, 
        ~u_tgany18_432, tgc_PDOL_0, $Terminal, $CA, $Bank, tgc_encPIN_0>
   ),
   Fr( ~channelID_431 )
   ]
  --[
  Running_92( $Terminal, $Bank,
              <'Terminal', 'Bank', ~u_tgany18_432, tgc_AIP_0, tgc_CVM_0, tgc_PDOL_0, 
               tgc_ATC_0, tgc_AC_0, tgc_IAD_0>
  )
  ]->
   [
   St( ~pid, 'tgk58',
       <tgc_CID_0, ~u_tgany18_432, $Terminal, $Bank, $CA, ~channelID_431, 
        ~u_tgany18_432, tgc_AIP_0, tgc_CVM_0, tgc_PDOL_0, tgc_ATC_0, tgc_AC_0, 
        tgc_IAD_0>
   ),
   Send_32( $Terminal, $Bank, <~channelID_431, 'Visa', '1'>,
            <
             <~u_tgany18_432, tgc_AIP_0, tgc_CVM_0, tgc_PDOL_0, tgc_ATC_0, tgc_AC_0, 
              tgc_IAD_0>, 
             tgc_encPIN_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_Visa_461_57to58:
   [
   St( ~pid, 'tgk57',
       <tgc_AC_0, tgc_AIP_0, tgc_ATC_0, tgc_CID_0, tgc_CVM_0, tgc_IAD_0, 
        ~u_tgany18_432, tgc_PDOL_0, $Terminal, $CA, $Bank, tgc_encPIN_0>
   ),
   Fr( ~channelID_431 )
   ]
  --[
  Running_92( $Terminal, $Bank,
              <'Terminal', 'Bank', ~u_tgany18_432, tgc_AIP_0, tgc_CVM_0, tgc_PDOL_0, 
               tgc_ATC_0, tgc_AC_0, tgc_IAD_0>
  )
  ]->
   [
   St( ~pid, 'tgk58',
       <tgc_CID_0, ~u_tgany18_432, $Terminal, $Bank, $CA, ~channelID_431, 
        ~u_tgany18_432, tgc_AIP_0, tgc_CVM_0, tgc_PDOL_0, tgc_ATC_0, tgc_AC_0, 
        tgc_IAD_0>
   ),
   Send_32( $Terminal, $Bank, <~channelID_431, 'Visa', '1'>,
            <
             <~u_tgany18_432, tgc_AIP_0, tgc_CVM_0, tgc_PDOL_0, tgc_ATC_0, tgc_AC_0, 
              tgc_IAD_0>, 
             tgc_encPIN_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_Visa_461_58to59:
   [
   St( ~pid, 'tgk58',
       <'TC', ~u_tgany17_438, $Terminal, $Bank, $CA, tgc_channelID_0, 
        ~u_tgany17_438, <'DDA', u_furtherData_439>, CVM_443, 
        <TTQ_441, $amount, country_437, currency_436, date_435, type_434, ~UN_440
        >, 
        ATC_444, AC_445, IAD_442>
   ),
   !Value_35( $amount, 'Low' )
   ]
  --[
  TerminalAccepts_248( <~u_tgany17_438, <'DDA', u_furtherData_439>, 
                        CVM_443, 
                        <TTQ_441, $amount, country_437, currency_436, date_435, type_434, ~UN_440
                        >, 
                        ATC_444, AC_445, IAD_442>
  ),
  Commit_249( 'Terminal', ~u_tgany17_438,
              <'Card', 'Terminal', ~u_tgany17_438, <'DDA', u_furtherData_439>, 
               CVM_443, 
               <TTQ_441, $amount, country_437, currency_436, date_435, type_434, ~UN_440
               >, 
               ATC_444, AC_445, IAD_442>
  ),
  Honest_80( $CA ), Honest_80( $Bank ), Honest_80( $Terminal ),
  Honest_80( ~u_tgany17_438 )
  ]->
   [ ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleTerminal_Visa_461_58to60:
   [
   St( ~pid, 'tgk58',
       <'ARQC', tgc_PAN_0, $Terminal, $Bank, $CA, tgc_channelID_0, ~PAN_454, 
        <'DDA', u_furtherData_451>, CVM_456, 
        <TTQ_453, $amount, country_450, currency_449, date_448, type_447, ~UN_452
        >, 
        ATC_457, AC_459, IAD_455>
   ),
   !Value_35( $amount, 'Low' ),
   Recv_33( $Bank, $Terminal, <tgc_channelID_0, 'Visa', '2'>,
            <'ARC', ARPC_458>
   )
   ]
  --[
  TerminalAccepts_248( <~PAN_454, <'DDA', u_furtherData_451>, CVM_456, 
                        <TTQ_453, $amount, country_450, currency_449, date_448, type_447, ~UN_452
                        >, 
                        ATC_457, AC_459, IAD_455>
  ),
  Commit_249( 'Terminal', tgc_PAN_0,
              <'Card', 'Terminal', ~PAN_454, <'DDA', u_furtherData_451>, CVM_456, 
               <TTQ_453, $amount, country_450, currency_449, date_448, type_447, ~UN_452
               >, 
               ATC_457, AC_459, IAD_455>
  ),
  Commit_249( $Terminal, $Bank,
              <'Bank', 'Terminal', ~PAN_454, <'DDA', u_furtherData_451>, CVM_456, 
               <TTQ_453, $amount, country_450, currency_449, date_448, type_447, ~UN_452
               >, 
               ATC_457, AC_459, IAD_455>
  ),
  Honest_80( $CA ), Honest_80( $Bank ), Honest_80( $Terminal ),
  Honest_80( tgc_PAN_0 )
  ]->
   [ ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgStartBank_505_61:
   [ Fr( ~pid ) ] --> [ St( ~pid, 'tgk61', 'empty_tuple' ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleBank_505_61to62:
   [
   St( ~pid, 'tgk61', 'empty_tuple' ),
   Recv_33( $Terminal, $Bank, <channelID_465, 'Mastercard', '1'>,
            <<~PAN_467, AIP_472, CVM_470, X_466, ATC_471, AC_473, IAD_469>, 
             encPIN_464>
   ),
   !Shk_67( ~PAN_467, ~MK_468 )
   ]
  --[
  NEq_26( MAC_29(f_28(~MK_468, ATC_471),
                 <X_466, AIP_472, ATC_471, IAD_469>),
          AC_473
  ),
  BankDeclines_462( <~PAN_467, AIP_472, CVM_470, X_466, ATC_471, AC_473, 
                     IAD_469>
  )
  ]->
   [ ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleBank_505_61to63:
   [
   St( ~pid, 'tgk61', 'empty_tuple' ),
   Recv_33( $Terminal, $Bank, <channelID_477, 'Mastercard', '1'>,
            <
             <~PAN_479, AIP_484, CVM_482, X_478, ATC_483, 
              MAC_29(f_28(~MK_480, ATC_483), <X_478, AIP_484, ATC_483, IAD_481>), 
              IAD_481>, 
             encPIN_476>
   ),
   !Shk_67( ~PAN_479, ~MK_480 ), !IssuingBank_66( ~PAN_479, $Bank )
   ]
  --[ Once_34( <~PAN_479, ATC_483, 'Bank'> ) ]->
   [
   St( ~pid, 'tgk63',
       <$Bank, $Terminal, encPIN_476, ~PAN_479, AIP_484, CVM_482, X_478, 
        ATC_483, 
        MAC_29(f_28(~MK_480, ATC_483), <X_478, AIP_484, ATC_483, IAD_481>), 
        IAD_481>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleBank_505_63to64:
   [
   St( ~pid, 'tgk63',
       <$Bank, $Terminal, 'Null', ~PAN_489, AIP_493, CVM_491, X_488, ATC_492, 
        AC_494, IAD_490>
   )
   ]
  --[
  NEq_26( CVM_491, 'OnlinePIN' ),
  Running_92( $Bank, $Terminal,
              <'Bank', 'Terminal', ~PAN_489, AIP_493, CVM_491, X_488, ATC_492, AC_494, 
               IAD_490>
  )
  ]->
   [ ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleBank_505_63to65:
   [
   St( ~pid, 'tgk63',
       <$Bank, $Terminal, aenc(PIN_498, pk(~privBank_496)), ~PAN_499, AIP_503, 
        'OnlinePIN', X_497, ATC_502, AC_504, IAD_501>
   ),
   !LtkBank_56( $Bank, ~privkBank_495 ), !PIN_85( ~PAN_499, PIN_498 ),
   !Shk_67( ~PAN_499, ~MK_500 )
   ]
  --[
  Running_92( $Bank, $Terminal,
              <'Bank', 'Terminal', ~PAN_499, AIP_503, 'OnlinePIN', X_497, ATC_502, 
               AC_504, IAD_501>
  )
  ]->
   [ ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgStartBank_Visa_567_66:
   [ Fr( ~pid ) ] --> [ St( ~pid, 'tgk66', 'empty_tuple' ) ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleBank_Visa_567_66to67:
   [
   St( ~pid, 'tgk66', 'empty_tuple' ),
   Recv_33( $Terminal, $Bank, <channelID_508, 'Visa', '1'>,
            <<~PAN_510, AIP_515, CVM_513, PDOL_509, ATC_514, AC_516, IAD_512>, 
             encPIN_507>
   ),
   !Shk_67( ~PAN_510, ~MK_511 )
   ]
  --[
  NEq_26( MAC_29(f_28(~MK_511, ATC_514),
                 <PDOL_509, AIP_515, ATC_514, IAD_512>),
          AC_516
  ),
  BankDeclines_462( <~PAN_510, AIP_515, CVM_513, PDOL_509, ATC_514, 
                     AC_516, IAD_512>
  )
  ]->
   [ ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleBank_Visa_567_66to68:
   [
   St( ~pid, 'tgk66', 'empty_tuple' ),
   Recv_33( $Terminal, $Bank, <channelID_520, 'Visa', '1'>,
            <
             <~PAN_522, AIP_527, CVM_525, PDOL_521, ATC_526, 
              MAC_29(f_28(~MK_523, ATC_526), <PDOL_521, AIP_527, ATC_526, IAD_524>), 
              IAD_524>, 
             encPIN_519>
   ),
   !Shk_67( ~PAN_522, ~MK_523 ), !IssuingBank_66( ~PAN_522, $Bank )
   ]
  --[ Once_34( <~PAN_522, ATC_526, 'Bank'> ) ]->
   [
   St( ~pid, 'tgk68',
       <
        MAC_arpc_30(f_28(~MK_523, ATC_526),
                    (MAC_29(f_28(~MK_523, ATC_526), <PDOL_521, AIP_527, ATC_526, IAD_524>)⊕
                     p8_31('ARC'))), 
        $Bank, $Terminal, channelID_520, encPIN_519, ~PAN_522, AIP_527, CVM_525, 
        PDOL_521, ATC_526, 
        MAC_29(f_28(~MK_523, ATC_526), <PDOL_521, AIP_527, ATC_526, IAD_524>), 
        IAD_524>
   )
   ]

  // loop breaker: [1]
  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleBank_Visa_567_68to69:
   [
   St( ~pid, 'tgk68',
       <tgc_ARPC_0, $Bank, $Terminal, tgc_channelID_0, 'Null', ~PAN_538, 
        AIP_542, CVM_540, 
        <TTQ_537, amount_535, country_534, currency_533, date_532, type_531, 
         UN_536>, 
        ATC_541, AC_543, IAD_539>
   )
   ]
  --[
  NEq_26( CVM_540, 'OnlinePIN' ),
  Running_92( $Bank, $Terminal,
              <'Bank', 'Terminal', ~PAN_538, AIP_542, CVM_540, 
               <TTQ_537, amount_535, country_534, currency_533, date_532, type_531, 
                UN_536>, 
               ATC_541, AC_543, IAD_539>
  )
  ]->
   [
   St( ~pid, 'tgk69',
       <tgc_ARPC_0, $Bank, $Terminal, tgc_channelID_0, ~PAN_538, AIP_542, 
        CVM_540, 
        <TTQ_537, amount_535, country_534, currency_533, date_532, type_531, 
         UN_536>, 
        ATC_541, AC_543, IAD_539>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleBank_Visa_567_68to70:
   [
   St( ~pid, 'tgk68',
       <tgc_ARPC_0, $Bank, $Terminal, tgc_channelID_0, 
        aenc(~PIN_546, pk(~privkBank_545)), ~PAN_548, AIP_551, 'OnlinePIN', 
        PDOL_547, ATC_550, AC_552, IAD_549>
   ),
   !LtkBank_56( $Bank, ~privkBank_545 ), !PIN_85( ~PAN_548, ~PIN_546 )
   ]
  --[
  Running_92( $Bank, $Terminal,
              <'Bank', 'Terminal', ~PAN_548, AIP_551, 'OnlinePIN', PDOL_547, ATC_550, 
               AC_552, IAD_549>
  )
  ]->
   [
   St( ~pid, 'tgk70',
       <tgc_ARPC_0, $Bank, $Terminal, tgc_channelID_0, ~PAN_548, AIP_551, 
        'OnlinePIN', PDOL_547, ATC_550, AC_552, IAD_549>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleBank_Visa_567_69to71:
   [
   St( ~pid, 'tgk69',
       <tgc_ARPC_0, $Bank, $Terminal, tgc_channelID_0, ~PAN_561, 
        <'DDA', u_furtherData_558>, CVM_563, 
        <TTQ_560, amount_557, country_556, currency_555, date_554, type_553, 
         UN_559>, 
        ATC_564, AC_565, IAD_562>
   ),
   !Value_35( amount_557, 'Low' ), !IssuingCA_58( $Bank, $CA )
   ]
  --[
  Commit_249( $Bank, ~PAN_561,
              <'Card', 'Bank', ~PAN_561, <'DDA', u_furtherData_558>, CVM_563, 
               <TTQ_560, amount_557, country_556, currency_555, date_554, type_553, 
                UN_559>, 
               ATC_564, AC_565, IAD_562>
  ),
  Commit_249( $Bank, $Terminal,
              <'Terminal', 'Bank', ~PAN_561, <'DDA', u_furtherData_558>, CVM_563, 
               <TTQ_560, amount_557, country_556, currency_555, date_554, type_553, 
                UN_559>, 
               ATC_564, AC_565, IAD_562>
  ),
  Honest_80( $CA ), Honest_80( $Bank ), Honest_80( $Terminal ),
  Honest_80( ~PAN_561 )
  ]->
   [
   Send_32( $Bank, $Terminal, <tgc_channelID_0, 'Visa', '2'>,
            <'ARC', tgc_ARPC_0>
   )
   ]

  /* has exactly the trivial AC variant */

rule (modulo E) TgRuleBank_Visa_567_70to71:
   [
   St( ~pid, 'tgk70',
       <tgc_ARPC_0, $Bank, $Terminal, tgc_channelID_0, ~PAN_561, 
        <'DDA', u_furtherData_558>, CVM_563, 
        <TTQ_560, amount_557, country_556, currency_555, date_554, type_553, 
         UN_559>, 
        ATC_564, AC_565, IAD_562>
   ),
   !Value_35( amount_557, 'Low' ), !IssuingCA_58( $Bank, $CA )
   ]
  --[
  Commit_249( $Bank, ~PAN_561,
              <'Card', 'Bank', ~PAN_561, <'DDA', u_furtherData_558>, CVM_563, 
               <TTQ_560, amount_557, country_556, currency_555, date_554, type_553, 
                UN_559>, 
               ATC_564, AC_565, IAD_562>
  ),
  Commit_249( $Bank, $Terminal,
              <'Terminal', 'Bank', ~PAN_561, <'DDA', u_furtherData_558>, CVM_563, 
               <TTQ_560, amount_557, country_556, currency_555, date_554, type_553, 
                UN_559>, 
               ATC_564, AC_565, IAD_562>
  ),
  Honest_80( $CA ), Honest_80( $Bank ), Honest_80( $Terminal ),
  Honest_80( ~PAN_561 )
  ]->
   [
   Send_32( $Bank, $Terminal, <tgc_channelID_0, 'Visa', '2'>,
            <'ARC', tgc_ARPC_0>
   )
   ]

  /* has exactly the trivial AC variant */

restriction equal:
  "∀ a_568 b_569 #i_570.
    (Eq_27( a_568, b_569 ) @ #i_570) ⇒ (a_568 = b_569)"
  // safety formula

restriction not_equal:
  "∀ a_572 #i_573. (NEq_26( a_572, a_572 ) @ #i_573) ⇒ (⊥)"
  // safety formula

restriction once:
  "∀ a_575 #i_576 #j_577.
    ((Once_34( a_575 ) @ #i_576) ∧ (Once_34( a_575 ) @ #j_577)) ⇒
    (#i_576 = #j_577)"
  // safety formula

restriction unique_role:
  "∀ A_579 r1_580 r2_581 #i_582 #j_583.
    ((Role_48( A_579, r1_580 ) @ #i_582) ∧
     (Role_48( A_579, r2_581 ) @ #j_583)) ⇒
    (r1_580 = r2_581)"
  // safety formula

restriction compatibility:
  "(∀ #i_585.
     (Compatible_CID_CVM_247( 'TC', 'OnlinePIN' ) @ #i_585) ⇒ (⊥)) ∧
   (∀ #i_586. (Compatible_CID_acType_246( 'TC', 'ARQC' ) @ #i_586) ⇒ (⊥))"
  // safety formula

lemma executable:
  exists-trace
  "∃ Bank_588 PAN_589 t_590 #i_591 #j_592 #k_593 #l_594.
    (((((((((#i_591 < #j_592) ∧
            (Running_92( PAN_589, 'Terminal', <'Card', 'Terminal', t_590>
             ) @ #i_591)) ∧
           (Commit_249( 'Terminal', PAN_589, <'Card', 'Terminal', t_590>
            ) @ #j_592)) ∧
          (#k_593 < #l_594)) ∧
         (Running_92( PAN_589, Bank_588, <'Card', 'Bank', t_590> ) @ #k_593)) ∧
        (Commit_249( Bank_588, PAN_589, <'Card', 'Bank', t_590> ) @ #l_594)) ∧
       (∀ #a_595 #b_596.
         ((OneCard_91( ) @ #a_595) ∧ (OneCard_91( ) @ #b_596)) ⇒
         (#a_595 = #b_596))) ∧
      (∀ #a_597 #b_598.
        ((OneTerminal_245( ) @ #a_597) ∧ (OneTerminal_245( ) @ #b_598)) ⇒
        (#a_597 = #b_598))) ∧
     (∀ A_599 B_600 r_601 #a_602 #b_603.
       ((Role_48( A_599, r_601 ) @ #a_602) ∧
        (Role_48( B_600, r_601 ) @ #b_603)) ⇒
       (A_599 = B_600))) ∧
    (¬(∃ A_604 #a_605. Compromise_65( A_604 ) @ #a_605))"
/*
guarded formula characterizing all satisfying traces:
"∃ Bank_588 PAN_589 t_590 #i_591 #j_592 #k_593 #l_594.
  (Running_92( PAN_589, 'Terminal', <'Card', 'Terminal', t_590>
   ) @ #i_591) ∧
  (Commit_249( 'Terminal', PAN_589, <'Card', 'Terminal', t_590>
   ) @ #j_592) ∧
  (Running_92( PAN_589, Bank_588, <'Card', 'Bank', t_590> ) @ #k_593) ∧
  (Commit_249( Bank_588, PAN_589, <'Card', 'Bank', t_590> ) @ #l_594)
 ∧
  (#i_591 < #j_592) ∧
  (#k_593 < #l_594) ∧
  (∀ #a_595 #b_596.
    (OneCard_91( ) @ #a_595) ∧ (OneCard_91( ) @ #b_596) ⇒ #a_595 = #b_596) ∧
  (∀ #a_597 #b_598.
    (OneTerminal_245( ) @ #a_597) ∧ (OneTerminal_245( ) @ #b_598)
   ⇒
    #a_597 = #b_598) ∧
  (∀ A_599 B_600 r_601 #a_602 #b_603.
    (Role_48( A_599, r_601 ) @ #a_602) ∧ (Role_48( B_600, r_601 ) @ #b_603)
   ⇒
    A_599 = B_600) ∧
  (∀ A_604 #a_605. (Compromise_65( A_604 ) @ #a_605) ⇒ ⊥)"
*/
by sorry

lemma bank_accepts:
  all-traces
  "∀ t_607 #i_608.
    (TerminalAccepts_248( t_607 ) @ #i_608) ⇒
    ((¬(∃ #j_609. BankDeclines_462( t_607 ) @ #j_609)) ∨
     (∃ A_610 #k_611.
       (Honest_80( A_610 ) @ #i_608) ∧ (Compromise_65( A_610 ) @ #k_611)))"
/*
guarded formula characterizing all counter-examples:
"∃ t_607 #i_608.
  (TerminalAccepts_248( t_607 ) @ #i_608)
 ∧
  (∃ #j_609. (BankDeclines_462( t_607 ) @ #j_609)) ∧
  (∀ A_610 #k_611.
    (Honest_80( A_610 ) @ #i_608) ∧ (Compromise_65( A_610 ) @ #k_611) ⇒ ⊥)"
*/
by sorry

lemma auth_to_terminal_minimal:
  all-traces
  "∀ T_613 P_614 r_615 t_616 #i_617.
    ((∀ #a_618 #b_619.
       ((OneCard_91( ) @ #a_618) ∧ (OneCard_91( ) @ #b_619)) ⇒
       (#a_618 = #b_619)) ∧
     (Commit_249( T_613, P_614, <r_615, 'Terminal', t_616> ) @ #i_617)) ⇒
    ((∃ #j_620.
       Running_92( P_614, T_613, <r_615, 'Terminal', t_616> ) @ #j_620) ∨
     (∃ A_621 #k_622.
       (Honest_80( A_621 ) @ #i_617) ∧ (Compromise_65( A_621 ) @ #k_622)))"
/*
guarded formula characterizing all counter-examples:
"∃ T_613 P_614 r_615 t_616 #i_617.
  (Commit_249( T_613, P_614, <r_615, 'Terminal', t_616> ) @ #i_617)
 ∧
  (∀ #a_618 #b_619.
    (OneCard_91( ) @ #a_618) ∧ (OneCard_91( ) @ #b_619) ⇒ #a_618 = #b_619) ∧
  (∀ #j_620.
    (Running_92( P_614, T_613, <r_615, 'Terminal', t_616> ) @ #j_620) ⇒ ⊥) ∧
  (∀ A_621 #k_622.
    (Honest_80( A_621 ) @ #i_617) ∧ (Compromise_65( A_621 ) @ #k_622) ⇒ ⊥)"
*/
by sorry

lemma auth_to_terminal:
  all-traces
  "∀ T_624 P_625 r_626 t_627 #i_628.
    (Commit_249( T_624, P_625, <r_626, 'Terminal', t_627> ) @ #i_628) ⇒
    (((∃ #j_629.
        (Running_92( P_625, T_624, <r_626, 'Terminal', t_627> ) @ #j_629) ∧
        (#j_629 < #i_628)) ∧
      (¬(∃ T2_630 P2_631 #i2_632.
          (Commit_249( T2_630, P2_631, <r_626, 'Terminal', t_627> ) @ #i2_632) ∧
          (¬(#i2_632 = #i_628))))) ∨
     (∃ A_633 #k_634.
       (Honest_80( A_633 ) @ #i_628) ∧ (Compromise_65( A_633 ) @ #k_634)))"
/*
guarded formula characterizing all counter-examples:
"∃ T_624 P_625 r_626 t_627 #i_628.
  (Commit_249( T_624, P_625, <r_626, 'Terminal', t_627> ) @ #i_628)
 ∧
  (((∀ #j_629.
      (Running_92( P_625, T_624, <r_626, 'Terminal', t_627> ) @ #j_629)
     ⇒
      ¬(#j_629 < #i_628)) ∨
    (∃ T2_630 P2_631 #i2_632.
      (Commit_249( T2_630, P2_631, <r_626, 'Terminal', t_627> ) @ #i2_632)
     ∧
      ¬(#i2_632 = #i_628)))) ∧
  (∀ A_633 #k_634.
    (Honest_80( A_633 ) @ #i_628) ∧ (Compromise_65( A_633 ) @ #k_634) ⇒ ⊥)"
*/
by sorry

lemma auth_to_bank_minimal:
  all-traces
  "∀ B_636 P_637 r_638 t_639 #i_640.
    ((∀ #a_641 #b_642.
       ((OneCard_91( ) @ #a_641) ∧ (OneCard_91( ) @ #b_642)) ⇒
       (#a_641 = #b_642)) ∧
     (Commit_249( B_636, P_637, <r_638, 'Bank', t_639> ) @ #i_640)) ⇒
    ((∃ #j_643.
       Running_92( P_637, B_636, <r_638, 'Bank', t_639> ) @ #j_643) ∨
     (∃ A_644 #k_645.
       (Honest_80( A_644 ) @ #i_640) ∧ (Compromise_65( A_644 ) @ #k_645)))"
/*
guarded formula characterizing all counter-examples:
"∃ B_636 P_637 r_638 t_639 #i_640.
  (Commit_249( B_636, P_637, <r_638, 'Bank', t_639> ) @ #i_640)
 ∧
  (∀ #a_641 #b_642.
    (OneCard_91( ) @ #a_641) ∧ (OneCard_91( ) @ #b_642) ⇒ #a_641 = #b_642) ∧
  (∀ #j_643.
    (Running_92( P_637, B_636, <r_638, 'Bank', t_639> ) @ #j_643) ⇒ ⊥) ∧
  (∀ A_644 #k_645.
    (Honest_80( A_644 ) @ #i_640) ∧ (Compromise_65( A_644 ) @ #k_645) ⇒ ⊥)"
*/
by sorry

lemma auth_to_bank:
  all-traces
  "∀ B_647 P_648 r_649 t_650 #i_651.
    (Commit_249( B_647, P_648, <r_649, 'Bank', t_650> ) @ #i_651) ⇒
    (((∃ #j_652.
        (Running_92( P_648, B_647, <r_649, 'Bank', t_650> ) @ #j_652) ∧
        (#j_652 < #i_651)) ∧
      (¬(∃ B2_653 P2_654 #i2_655.
          (Commit_249( B2_653, P2_654, <r_649, 'Bank', t_650> ) @ #i2_655) ∧
          (¬(#i2_655 = #i_651))))) ∨
     (∃ A_656 #k_657.
       (Honest_80( A_656 ) @ #i_651) ∧ (Compromise_65( A_656 ) @ #k_657)))"
/*
guarded formula characterizing all counter-examples:
"∃ B_647 P_648 r_649 t_650 #i_651.
  (Commit_249( B_647, P_648, <r_649, 'Bank', t_650> ) @ #i_651)
 ∧
  (((∀ #j_652.
      (Running_92( P_648, B_647, <r_649, 'Bank', t_650> ) @ #j_652)
     ⇒
      ¬(#j_652 < #i_651)) ∨
    (∃ B2_653 P2_654 #i2_655.
      (Commit_249( B2_653, P2_654, <r_649, 'Bank', t_650> ) @ #i2_655)
     ∧
      ¬(#i2_655 = #i_651)))) ∧
  (∀ A_656 #k_657.
    (Honest_80( A_656 ) @ #i_651) ∧ (Compromise_65( A_656 ) @ #k_657) ⇒ ⊥)"
*/
by sorry

lemma secrecy_MK:
  all-traces
  "∀ MK_659 #i_660.
    (SecretMK_82( MK_659 ) @ #i_660) ⇒
    ((¬(∃ #j_661. !KU( MK_659 ) @ #j_661)) ∨
     (∃ A_662 #k_663.
       (Honest_80( A_662 ) @ #i_660) ∧ (Compromise_65( A_662 ) @ #k_663)))"
/*
guarded formula characterizing all counter-examples:
"∃ MK_659 #i_660.
  (SecretMK_82( MK_659 ) @ #i_660)
 ∧
  (∃ #j_661. (!KU( MK_659 ) @ #j_661)) ∧
  (∀ A_662 #k_663.
    (Honest_80( A_662 ) @ #i_660) ∧ (Compromise_65( A_662 ) @ #k_663) ⇒ ⊥)"
*/
by sorry

lemma secrecy_privkCard:
  all-traces
  "∀ privkCard_665 #i_666.
    (SecretPrivkCard_96( privkCard_665 ) @ #i_666) ⇒
    ((¬(∃ #j_667. !KU( privkCard_665 ) @ #j_667)) ∨
     (∃ A_668 #k_669.
       (Honest_80( A_668 ) @ #i_666) ∧ (Compromise_65( A_668 ) @ #k_669)))"
/*
guarded formula characterizing all counter-examples:
"∃ privkCard_665 #i_666.
  (SecretPrivkCard_96( privkCard_665 ) @ #i_666)
 ∧
  (∃ #j_667. (!KU( privkCard_665 ) @ #j_667)) ∧
  (∀ A_668 #k_669.
    (Honest_80( A_668 ) @ #i_666) ∧ (Compromise_65( A_668 ) @ #k_669) ⇒ ⊥)"
*/
by sorry

lemma secrecy_PIN:
  all-traces
  "∀ PIN_671 #i_672.
    (SecretPIN_79( PIN_671 ) @ #i_672) ⇒
    ((¬(∃ #j_673. !KU( PIN_671 ) @ #j_673)) ∨
     (∃ A_674 #k_675.
       (Honest_80( A_674 ) @ #i_672) ∧ (Compromise_65( A_674 ) @ #k_675)))"
/*
guarded formula characterizing all counter-examples:
"∃ PIN_671 #i_672.
  (SecretPIN_79( PIN_671 ) @ #i_672)
 ∧
  (∃ #j_673. (!KU( PIN_671 ) @ #j_673)) ∧
  (∀ A_674 #k_675.
    (Honest_80( A_674 ) @ #i_672) ∧ (Compromise_65( A_674 ) @ #k_675) ⇒ ⊥)"
*/
by sorry

lemma secrecy_PAN:
  all-traces
  "∀ PAN_677 #i_678.
    (SecretPAN_81( PAN_677 ) @ #i_678) ⇒
    ((¬(∃ #j_679. !KU( PAN_677 ) @ #j_679)) ∨
     (∃ A_680 #k_681.
       (Honest_80( A_680 ) @ #i_678) ∧ (Compromise_65( A_680 ) @ #k_681)))"
/*
guarded formula characterizing all counter-examples:
"∃ PAN_677 #i_678.
  (SecretPAN_81( PAN_677 ) @ #i_678)
 ∧
  (∃ #j_679. (!KU( PAN_677 ) @ #j_679)) ∧
  (∀ A_680 #k_681.
    (Honest_80( A_680 ) @ #i_678) ∧ (Compromise_65( A_680 ) @ #k_681) ⇒ ⊥)"
*/
simplify
solve( SecretPAN_81( PAN_677 ) @ #i_678 )
  case Create_Card_124
  solve( !LtkBank_56( $Bank, ~privkBank_115 ) ▶₃ #i_678 )
    case Create_Bank_64
    solve( !CertBank_57( $Bank, certBank_117 ) ▶₄ #i_678 )
      case Create_Bank_64
      solve( !IssuingCA_58( $Bank, $CA.1 ) ▶₅ #i_678 )
        case Create_Bank_64
        solve( !KU( ~PAN_119 ) @ #j_679 )
          case TgRuleCard_170_17to18_case_1
          SOLVED // trace found
        qed
      qed
    qed
  qed
qed

/* All well-formedness checks were successful. */

end